(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{412:function(s,t,a){s.exports=a.p+"assets/img/dotnet.docker.tag.1.458019a4.png"},617:function(s,t,a){"use strict";a.r(t);var e=a(25),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"ef-core"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ef-core"}},[s._v("#")]),s._v(" ef core")]),s._v(" "),t("TagLinks"),s._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#ef-core-tool-설치"}},[s._v("ef core tool 설치")])]),t("li",[t("a",{attrs:{href:"#ef-core-migration"}},[s._v("ef core migration")])]),t("li",[t("a",{attrs:{href:"#ef-core-로-sql-server-연결-시-오류"}},[s._v("ef core 로 sql server 연결 시 오류")]),t("ul",[t("li",[t("a",{attrs:{href:"#현상"}},[s._v("현상")])]),t("li",[t("a",{attrs:{href:"#해결"}},[s._v("해결")])])])]),t("li",[t("a",{attrs:{href:"#reference"}},[s._v("Reference")])])])]),t("p"),s._v(" "),t("h2",{attrs:{id:"ef-core-tool-설치"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ef-core-tool-설치"}},[s._v("#")]),s._v(" ef core tool 설치")]),s._v(" "),t("blockquote",[t("p",[s._v("docker 로 .net core app 을 실행 시에 ef core migration 이 필요한 경우가 있음"),t("br"),s._v("\ncsproj에 ef core tool 을 포함시킬 경우는")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ dotnet "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" package Microsoft.EntityFrameworkCore.Design "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# project 에 직접 포함 (패키지 관리자 콘솔용)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# or")]),s._v("\n$ dotnet tool "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--global")]),s._v(" dotnet-ef "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cli 방식")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"ef-core-migration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ef-core-migration"}},[s._v("#")]),s._v(" ef core migration")]),s._v(" "),t("blockquote",[t("p",[s._v("migration 생성 및 업데이트")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ dotnet ef migrations "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" AddColumn "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--project")]),s._v(" coreTodoApi.csproj\n$ dotnet ef database update "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--project")]),s._v(" coreTodoApi.csproj\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("blockquote",[t("p",[s._v("scaffolding")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ dotnet ef dbcontext scaffold "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Server=localhost;Database=todos;Integrated Security=false;User ID=sa;Password=y0urStrong!Password;"')]),s._v(" Microsoft.EntityFrameworkCore.SqlServer "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" Models\n$ dotnet ef dbcontext scaffold "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Server=localhost;Database=todos;Integrated Security=false;User ID=sa;Password=y0urStrong!Password;"')]),s._v(" Microsoft.EntityFrameworkCore.SqlServer "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" Models "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" TodoItems "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" 테이블명 --context-dir Models "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" TodoContext --context-namespace Todo.Api\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("blockquote",[t("p",[s._v("api 등이 시작되는 시점에서 db migration 하도록 설정하기 위해서는")])]),s._v(" "),t("div",{staticClass:"language-csharp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-csharp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Startup.cs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ConfigureServices")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IServiceCollection")]),s._v(" services"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//   services.AddDbContext<TodoContext>(opt => opt.UseInMemoryDatabase("TodoList"));')]),s._v("\n  services"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token generic-method"}},[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("AddDbContext")]),t("span",{pre:!0,attrs:{class:"token generic class-name"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("TodoContext"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("opt "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" opt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("UseSqlServer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"connectionString"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  services"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("AddControllers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Configure")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IApplicationBuilder")]),s._v(" app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IWebHostEnvironment")]),s._v(" env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// DbContext migrate")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ApplicationServices"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token generic-method"}},[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("GetService")]),t("span",{pre:!0,attrs:{class:"token generic class-name"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("TodoContext"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Database"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("GetPendingMigrations")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Any")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ApplicationServices"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token generic-method"}},[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("GetService")]),t("span",{pre:!0,attrs:{class:"token generic class-name"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("TodoContext"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Database"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Migrate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("h2",{attrs:{id:"ef-core-로-sql-server-연결-시-오류"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ef-core-로-sql-server-연결-시-오류"}},[s._v("#")]),s._v(" ef core 로 sql server 연결 시 오류")]),s._v(" "),t("blockquote",[t("p",[s._v("A connection was successfully established with the server, but then an error occurred during the pre-login handshake. (provider: SSL Provider, error: 31 - Encryption(ssl/tls) handshake failed)")])]),s._v(" "),t("h3",{attrs:{id:"현상"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#현상"}},[s._v("#")]),s._v(" 현상")]),s._v(" "),t("ul",[t("li",[s._v(".net core 앱을 dockerizing 할 경우, 보통 다음과 같이 "),t("code",[s._v("Dockerfile")]),s._v(" 을 작성한다.")])]),s._v(" "),t("div",{staticClass:"language-docker line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-docker"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" mcr.microsoft.com/dotnet/aspnet:5.0 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" base")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" mcr.microsoft.com/dotnet/sdk:5.0 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" build")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /src")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sample.api.csproj"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./"')]),s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" dotnet restore "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./sample.api.csproj"')])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . .")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/src/."')])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" dotnet build "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sample.api.csproj"')]),s._v(" -c Release -o /app/build")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" build "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" publish")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" dotnet publish "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sample.api.csproj"')]),s._v(" -c Release -o /app/publish")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" base "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" final")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" maintainer="),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Jun Yu <shockzinfinity@gmail.com>"')])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token options"}},[t("span",{pre:!0,attrs:{class:"token property"}},[s._v("--from")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("publish")])]),s._v(" /app/publish .")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" ASPNETCORE_URLS http://*:5001")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dotnet"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sample.api.dll"')]),s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("ul",[t("li",[s._v("base 및 build 이미지를 .net standard 5.0 은 "),t("code",[s._v("mcr.microsoft.com/dotnet/aspnet:5.0")]),s._v(", .net core 3.1 은 "),t("code",[s._v("mcr.microsoft.com/dotnet/aspnet:3.1")]),s._v(" 등으로 사용하여 dockerizing 하게 되는데,")]),s._v(" "),t("li",[s._v("기본 태그의 이미지는 container 의 size 를 줄이기 위해 buster 나 buster-slim 이다. ("),t("a",{attrs:{href:"https://hub.docker.com/_/microsoft-dotnet-sdk?tab=description",target:"_blank",rel:"noopener noreferrer"}},[s._v("dotnet tag"),t("OutboundLink")],1),s._v(")\n"),t("img",{attrs:{src:a(412),alt:"dotnet.docker.tag"}})]),s._v(" "),t("li",[s._v("해당 태그는 Ubuntu 20.04 등을 사용하여 빌드된 이미지 이다.")]),s._v(" "),t("li",[s._v("Ubuntu 20.04 가 되면서 기본 openssl security level 변경되어 다음과 같은 에러가 발생할 수 있다.")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("System.Data.SqlClient.SqlException "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x80131904"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": A connection was successfully established with the server, but "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v(" an error occurred during the pre-login handshake. "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("provider: SSL Provider, error: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" - Encryption"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ssl/tls"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" handshake failed"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"해결"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#해결"}},[s._v("#")]),s._v(" 해결")]),s._v(" "),t("ul",[t("li",[s._v("이 에러를 해결하기 위해서는 "),t("code",[s._v("Dockerfile")]),s._v(" 에서 base 이미지를 하위 버전은 리눅스 이미지 (Ubuntu 18.04 를 base로 하는 "),t("code",[s._v("3.1-bionic")]),s._v(")를 사용하도록 하거나, ENTRYPOINT 전에 "),t("code",[s._v("/etc/ssl/openssl.cnf")]),s._v(" 를 조정해줘야 한다.")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://itectec.com/ubuntu/ubuntu-ubuntu-20-04-how-to-set-lower-ssl-security-level/#",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://itectec.com/ubuntu/ubuntu-ubuntu-20-04-how-to-set-lower-ssl-security-level/#"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://askubuntu.com/questions/1233186/ubuntu-20-04-how-to-set-lower-ssl-security-level",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://askubuntu.com/questions/1233186/ubuntu-20-04-how-to-set-lower-ssl-security-level"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("그래서 다음과 같이 조치하도록 한다.")])]),s._v(" "),t("div",{staticClass:"language-docker line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-docker"}},[t("code",[s._v("...\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token options"}},[t("span",{pre:!0,attrs:{class:"token property"}},[s._v("--from")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("publish")])]),s._v(" /app/publish .")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" ASPNETCORE_URLS http://*:5001")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" sed -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/DEFAULT@SECLEVEL=2/DEFAULT@SECLEVEL=1/g'")]),s._v(" /etc/ssl/openssl.cnf")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dotnet"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sample.api.dll"')]),s._v("]")]),s._v("\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v("openssl 의 SECLEVEL 을 조정함으로서 SSL 관련 오류를 우회한다.")])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("ul",[t("li",[s._v("관련 정보\n"),t("ul",[t("li",[t("a",{attrs:{href:"https://ivorycirrus.github.io/TIL/openssl-seclevel/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ubuntu 20.04 openssl의 key길이 문제(SECLEVEL)"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://rsec.kr/?p=242",target:"_blank",rel:"noopener noreferrer"}},[s._v("디피 헬만 키 (Diffie-Hellman Key) 를 2048 bit 로 바꿔야 하는 이유"),t("OutboundLink")],1)])])])])]),s._v(" "),t("h2",{attrs:{id:"reference"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#reference"}},[s._v("#")]),s._v(" Reference")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.microsoft.com/ko-kr/ef/core/miscellaneous/cli/powershell",target:"_blank",rel:"noopener noreferrer"}},[s._v("package management console"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://docs.microsoft.com/ko-kr/ef/core/miscellaneous/cli/dotnet",target:"_blank",rel:"noopener noreferrer"}},[s._v("cli"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://docs.microsoft.com/ko-kr/ef/core/managing-schemas/scaffolding?tabs=dotnet-core-cli",target:"_blank",rel:"noopener noreferrer"}},[s._v("리버스엔지니어링"),t("OutboundLink")],1)])])],1)}),[],!1,null,null,null);t.default=n.exports}}]);