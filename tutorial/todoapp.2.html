<!DOCTYPE html>
<html lang="ko-KR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Todo App tutorial | ironpot devLog</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/icons/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/img/icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/img/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/icons/favicon-16x16.png">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-MM4TDVZJ85"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-MM4TDVZJ85');
    </script>
    <link rel="alternate" type="application/rss+xml" href="https://shockzinfinity.github.io/rss.xml" title="ironpot devLog RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://shockzinfinity.github.io/feed.atom" title="ironpot devLog Atom Feed">
    <link rel="alternate" type="application/json" href="https://shockzinfinity.github.io/feed.json" title="ironpot devLog JSON Feed">
    <meta name="description" content="Todo App 을 만드는 꽤 복잡한 방법">
    <meta name="keywords" content="todoapp">
    <meta name="google-site-verification" content="hwS5SAeZJGMx-RCbFtzbcv0IGdU4nIN8mAfE2iAMhSA">
    <meta name="naver-site-verification" content="cd32f721debd9633141e4a04c83fad98d36a5abc">
    <meta name="theme-color" content="#2196f3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="ironPot">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="msapplication-TileColor" content="#2196f3">
    <meta name="msapplication-TileImage" content="/img/icons/ms-icon-144x144.png">
    <meta name="og:type" content="website">
    <meta name="og:title" content="ironPot42 dev log site">
    <meta name="og:description" content="Development log for ironPot42">
    <meta name="og:url" content="https://shockzinfinity.github.io">
    <meta name="og:image" content="/img/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.0ac55d30.css" as="style"><link rel="preload" href="/assets/js/app.235aa418.js" as="script"><link rel="preload" href="/assets/js/32.2f97a545.js" as="script"><link rel="preload" href="/assets/js/2.c6e841d7.js" as="script"><link rel="preload" href="/assets/js/1.be22eaca.js" as="script"><link rel="preload" href="/assets/js/10.08dc9b50.js" as="script"><link rel="preload" href="/assets/js/39.8f7876c0.js" as="script"><link rel="preload" href="/assets/js/40.0f869326.js" as="script"><link rel="prefetch" href="/assets/js/11.586c6ce3.js"><link rel="prefetch" href="/assets/js/12.3b1f2e73.js"><link rel="prefetch" href="/assets/js/13.cf93a349.js"><link rel="prefetch" href="/assets/js/14.48be74c2.js"><link rel="prefetch" href="/assets/js/15.b5a6f882.js"><link rel="prefetch" href="/assets/js/16.5a3ab8c8.js"><link rel="prefetch" href="/assets/js/17.b01ce45e.js"><link rel="prefetch" href="/assets/js/18.8afaf987.js"><link rel="prefetch" href="/assets/js/19.db7b48de.js"><link rel="prefetch" href="/assets/js/20.b3b734fb.js"><link rel="prefetch" href="/assets/js/21.5252a576.js"><link rel="prefetch" href="/assets/js/22.6f43ce1b.js"><link rel="prefetch" href="/assets/js/23.700d3cb4.js"><link rel="prefetch" href="/assets/js/24.447eed5d.js"><link rel="prefetch" href="/assets/js/25.f2356c7a.js"><link rel="prefetch" href="/assets/js/26.b392f38f.js"><link rel="prefetch" href="/assets/js/27.a6755c58.js"><link rel="prefetch" href="/assets/js/28.12ccef81.js"><link rel="prefetch" href="/assets/js/29.ac459999.js"><link rel="prefetch" href="/assets/js/3.b9af6c4f.js"><link rel="prefetch" href="/assets/js/30.b335756e.js"><link rel="prefetch" href="/assets/js/31.ca339667.js"><link rel="prefetch" href="/assets/js/33.cce37131.js"><link rel="prefetch" href="/assets/js/34.7f1ed12a.js"><link rel="prefetch" href="/assets/js/35.83f70d4a.js"><link rel="prefetch" href="/assets/js/36.f3b23cd2.js"><link rel="prefetch" href="/assets/js/37.7a2df46c.js"><link rel="prefetch" href="/assets/js/38.c2c82975.js"><link rel="prefetch" href="/assets/js/4.93d7c993.js"><link rel="prefetch" href="/assets/js/41.ad359ed2.js"><link rel="prefetch" href="/assets/js/42.8c27b04e.js"><link rel="prefetch" href="/assets/js/43.0b5daa81.js"><link rel="prefetch" href="/assets/js/44.46df54b4.js"><link rel="prefetch" href="/assets/js/45.e12547b7.js"><link rel="prefetch" href="/assets/js/46.0fde9b14.js"><link rel="prefetch" href="/assets/js/47.4c184099.js"><link rel="prefetch" href="/assets/js/48.67492e7a.js"><link rel="prefetch" href="/assets/js/49.0cd0b7c6.js"><link rel="prefetch" href="/assets/js/5.a6223022.js"><link rel="prefetch" href="/assets/js/50.0ed20d79.js"><link rel="prefetch" href="/assets/js/51.520e4c33.js"><link rel="prefetch" href="/assets/js/52.f770fb14.js"><link rel="prefetch" href="/assets/js/53.131a171e.js"><link rel="prefetch" href="/assets/js/54.f6f8a2b1.js"><link rel="prefetch" href="/assets/js/55.32e848a1.js"><link rel="prefetch" href="/assets/js/56.a08a9a6b.js"><link rel="prefetch" href="/assets/js/57.56f4b7ba.js"><link rel="prefetch" href="/assets/js/58.da91841d.js"><link rel="prefetch" href="/assets/js/59.169bbdf4.js"><link rel="prefetch" href="/assets/js/6.351cefac.js"><link rel="prefetch" href="/assets/js/60.a6361cfc.js"><link rel="prefetch" href="/assets/js/61.8a12f03b.js"><link rel="prefetch" href="/assets/js/62.a654d72a.js"><link rel="prefetch" href="/assets/js/63.bba47650.js"><link rel="prefetch" href="/assets/js/64.49ea6d5e.js"><link rel="prefetch" href="/assets/js/65.c9a180db.js"><link rel="prefetch" href="/assets/js/66.59af28e1.js"><link rel="prefetch" href="/assets/js/67.b596b57d.js"><link rel="prefetch" href="/assets/js/68.12a66673.js"><link rel="prefetch" href="/assets/js/69.774d628f.js"><link rel="prefetch" href="/assets/js/7.76cb897b.js"><link rel="prefetch" href="/assets/js/70.1fc0cd62.js"><link rel="prefetch" href="/assets/js/71.733ff8e5.js"><link rel="prefetch" href="/assets/js/72.c256780c.js"><link rel="prefetch" href="/assets/js/73.49fd3654.js"><link rel="prefetch" href="/assets/js/74.723f0509.js"><link rel="prefetch" href="/assets/js/75.79e7f053.js"><link rel="prefetch" href="/assets/js/76.8b51eb2d.js"><link rel="prefetch" href="/assets/js/77.667ebbe2.js"><link rel="prefetch" href="/assets/js/78.e4f6aa85.js"><link rel="prefetch" href="/assets/js/79.0c959f73.js"><link rel="prefetch" href="/assets/js/80.29f025d5.js"><link rel="prefetch" href="/assets/js/81.537c9575.js"><link rel="prefetch" href="/assets/js/82.f30d4d39.js"><link rel="prefetch" href="/assets/js/83.00bfcb63.js"><link rel="prefetch" href="/assets/js/84.8fd4a10e.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.74777bb7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0ac55d30.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-9cf26668><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">ironpot devLog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/tags.html" class="nav-link">
  tags
</a></div><div class="nav-item"><a href="/tutorial/" class="nav-link router-link-active">
  Tutorial
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Developement Log" class="dropdown-title"><span class="title">devLog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Developement Log" class="mobile-dropdown-title"><span class="title">devLog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dev-log/centos.html" class="nav-link">
  CentOS 8
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/podman.html" class="nav-link">
  Podman
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/docker.html" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/xwiki.html" class="nav-link">
  Xwiki
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/synology.html" class="nav-link">
  Synology NAS
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/gitlab.html" class="nav-link">
  GitLab
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/github.html" class="nav-link">
  GitHub
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/ssl.html" class="nav-link">
  SSL
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/nginx.html" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/dotnetcore.html" class="nav-link">
  .net core
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/konva.html" class="nav-link">
  Konva Test
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/vuepress.html" class="nav-link">
  VuePress
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/vuejs.html" class="nav-link">
  Vue.js
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/mssql.html" class="nav-link">
  mssql
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/maria.html" class="nav-link">
  mariaDB
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/efcore.html" class="nav-link">
  EF core
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/wordpress.html" class="nav-link">
  WordPress
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/npm.html" class="nav-link">
  NPM
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/jenkins.html" class="nav-link">
  Jenkins
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/code-server.html" class="nav-link">
  code-server
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/aws.html" class="nav-link">
  aws
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/linux.html" class="nav-link">
  linux
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/selenium.html" class="nav-link">
  selenium
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/python.html" class="nav-link">
  python
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/kubernetes.html" class="nav-link">
  kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/path-polisher.html" class="nav-link">
  PathPolisher
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="etc" class="dropdown-title"><span class="title">etc</span> <span class="arrow down"></span></button> <button type="button" aria-label="etc" class="mobile-dropdown-title"><span class="title">etc</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/etc/devEnv.html" class="nav-link">
  개발환경설정
</a></li><li class="dropdown-item"><!----> <a href="/etc/vscode-debugging.html" class="nav-link">
  vscode-debugging
</a></li><li class="dropdown-item"><!----> <a href="/etc/vscode.html" class="nav-link">
  VS Code 관련
</a></li><li class="dropdown-item"><!----> <a href="/etc/mac-etc.html" class="nav-link">
  mac 사용관련
</a></li><li class="dropdown-item"><!----> <a href="/etc/iPad.html" class="nav-link">
  iPad 사용관련
</a></li><li class="dropdown-item"><!----> <a href="/etc/markdown.html" class="nav-link">
  markdown
</a></li><li class="dropdown-item"><!----> <a href="/etc/windows.html" class="nav-link">
  windows
</a></li><li class="dropdown-item"><!----> <a href="/etc/php.html" class="nav-link">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/etc/tools.html" class="nav-link">
  Tools
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/tags.html" class="nav-link">
  tags
</a></div><div class="nav-item"><a href="/tutorial/" class="nav-link router-link-active">
  Tutorial
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Developement Log" class="dropdown-title"><span class="title">devLog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Developement Log" class="mobile-dropdown-title"><span class="title">devLog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dev-log/centos.html" class="nav-link">
  CentOS 8
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/podman.html" class="nav-link">
  Podman
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/docker.html" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/xwiki.html" class="nav-link">
  Xwiki
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/synology.html" class="nav-link">
  Synology NAS
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/gitlab.html" class="nav-link">
  GitLab
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/github.html" class="nav-link">
  GitHub
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/ssl.html" class="nav-link">
  SSL
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/nginx.html" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/dotnetcore.html" class="nav-link">
  .net core
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/konva.html" class="nav-link">
  Konva Test
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/vuepress.html" class="nav-link">
  VuePress
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/vuejs.html" class="nav-link">
  Vue.js
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/mssql.html" class="nav-link">
  mssql
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/maria.html" class="nav-link">
  mariaDB
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/efcore.html" class="nav-link">
  EF core
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/wordpress.html" class="nav-link">
  WordPress
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/npm.html" class="nav-link">
  NPM
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/jenkins.html" class="nav-link">
  Jenkins
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/code-server.html" class="nav-link">
  code-server
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/aws.html" class="nav-link">
  aws
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/linux.html" class="nav-link">
  linux
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/selenium.html" class="nav-link">
  selenium
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/python.html" class="nav-link">
  python
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/kubernetes.html" class="nav-link">
  kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/dev-log/path-polisher.html" class="nav-link">
  PathPolisher
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="etc" class="dropdown-title"><span class="title">etc</span> <span class="arrow down"></span></button> <button type="button" aria-label="etc" class="mobile-dropdown-title"><span class="title">etc</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/etc/devEnv.html" class="nav-link">
  개발환경설정
</a></li><li class="dropdown-item"><!----> <a href="/etc/vscode-debugging.html" class="nav-link">
  vscode-debugging
</a></li><li class="dropdown-item"><!----> <a href="/etc/vscode.html" class="nav-link">
  VS Code 관련
</a></li><li class="dropdown-item"><!----> <a href="/etc/mac-etc.html" class="nav-link">
  mac 사용관련
</a></li><li class="dropdown-item"><!----> <a href="/etc/iPad.html" class="nav-link">
  iPad 사용관련
</a></li><li class="dropdown-item"><!----> <a href="/etc/markdown.html" class="nav-link">
  markdown
</a></li><li class="dropdown-item"><!----> <a href="/etc/windows.html" class="nav-link">
  windows
</a></li><li class="dropdown-item"><!----> <a href="/etc/php.html" class="nav-link">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/etc/tools.html" class="nav-link">
  Tools
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Todo App tutorial</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/todoapp.2.html#api-step-backend" class="sidebar-link">API Step (Backend)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tutorial/todoapp.2.html#intorduction" class="sidebar-link">Intorduction</a></li><li class="sidebar-sub-header"><a href="/tutorial/todoapp.2.html#todo-webapi-restful" class="sidebar-link">Todo WebAPI(RESTful)</a></li><li class="sidebar-sub-header"><a href="/tutorial/todoapp.2.html#dockerize" class="sidebar-link">Dockerize</a></li><li class="sidebar-sub-header"><a href="/tutorial/todoapp.2.html#nginx-reverse-proxy" class="sidebar-link">Nginx reverse proxy</a></li><li class="sidebar-sub-header"><a href="/tutorial/todoapp.2.html#ssl-적용" class="sidebar-link">SSL 적용</a></li><li class="sidebar-sub-header"><a href="/tutorial/todoapp.2.html#improvements-fix" class="sidebar-link">Improvements &amp; Fix</a></li><li class="sidebar-sub-header"><a href="/tutorial/todoapp.2.html#sql-migration-script-적용" class="sidebar-link">SQL migration script 적용</a></li><li class="sidebar-sub-header"><a href="/tutorial/todoapp.2.html#dto-사용" class="sidebar-link">DTO 사용</a></li><li class="sidebar-sub-header"><a href="/tutorial/todoapp.2.html#general-domain-ssl-적용-shockz-io" class="sidebar-link">general domain ssl 적용 (shockz.io)</a></li><li class="sidebar-sub-header"><a href="/tutorial/todoapp.2.html#load-balancing-with-docker-compose" class="sidebar-link">load balancing with docker-compose</a></li><li class="sidebar-sub-header"><a href="/tutorial/todoapp.2.html#logging" class="sidebar-link">logging</a></li><li class="sidebar-sub-header"><a href="/tutorial/todoapp.2.html#swagger-openapi" class="sidebar-link">Swagger (OpenAPI)</a></li><li class="sidebar-sub-header"><a href="/tutorial/todoapp.2.html#authentication" class="sidebar-link">Authentication</a></li><li class="sidebar-sub-header"><a href="/tutorial/todoapp.2.html#slightly-business-changes" class="sidebar-link">Slightly business changes</a></li><li class="sidebar-sub-header"><a href="/tutorial/todoapp.2.html#conclusion" class="sidebar-link">Conclusion</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="todo-app-tutorial-2-backend"><a href="#todo-app-tutorial-2-backend" class="header-anchor">#</a> Todo App Tutorial #2 - Backend</h1> <div class="tags" data-v-77ca7535>Tags: <a href="/tags.html#todoapp" class="tag" data-v-77ca7535>todoapp</a><a href="/tags.html#.net core" class="tag" data-v-77ca7535>.net core</a><a href="/tags.html#nginx" class="tag" data-v-77ca7535>nginx</a><a href="/tags.html#mssql" class="tag" data-v-77ca7535>mssql</a><a href="/tags.html#docker" class="tag" data-v-77ca7535>docker</a><a href="/tags.html#ssl" class="tag" data-v-77ca7535>ssl</a><a href="/tags.html#swagger" class="tag" data-v-77ca7535>swagger</a><a href="/tags.html#seq" class="tag" data-v-77ca7535>seq</a><a href="/tags.html#serilog" class="tag" data-v-77ca7535>serilog</a><a href="/tags.html#docker-compose" class="tag" data-v-77ca7535>docker-compose</a><a href="/tags.html#cqrs / es" class="tag" data-v-77ca7535>cqrs / es</a></div> <hr> <blockquote><p>부제: Todo App 을 만드는 <strong>꽤</strong> 복잡한 방법<br>
참고 Repository: <a href="https://github.com/shockzinfinity/todo-app-complicated" target="_blank" rel="noopener noreferrer">Github Repository<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p></p><div class="table-of-contents"><ul><li><a href="#api-step-backend">API Step (Backend)</a><ul><li><a href="#intorduction">Intorduction</a></li><li><a href="#todo-webapi-restful">Todo WebAPI(RESTful)</a></li><li><a href="#dockerize">Dockerize</a></li><li><a href="#nginx-reverse-proxy">Nginx reverse proxy</a></li><li><a href="#ssl-적용">SSL 적용</a></li><li><a href="#improvements-fix">Improvements &amp; Fix</a></li><li><a href="#sql-migration-script-적용">SQL migration script 적용</a></li><li><a href="#dto-사용">DTO 사용</a></li><li><a href="#general-domain-ssl-적용-shockz-io">general domain ssl 적용 (shockz.io)</a></li><li><a href="#load-balancing-with-docker-compose">load balancing with docker-compose</a></li><li><a href="#logging">logging</a></li><li><a href="#swagger-openapi">Swagger (OpenAPI)</a></li><li><a href="#authentication">Authentication</a></li><li><a href="#slightly-business-changes">Slightly business changes</a></li><li><a href="#conclusion">Conclusion</a></li></ul></li></ul></div><p></p> <hr> <h2 id="api-step-backend"><a href="#api-step-backend" class="header-anchor">#</a> API Step (Backend)</h2> <h3 id="intorduction"><a href="#intorduction" class="header-anchor">#</a> Intorduction</h3> <p>이번 섹션에서는 Backend 를 다룹니다. Backend 는 사실 눈에 보이는 뭔가를 설명하기는 좀 힘들다고 생각합니다. 비즈니스 정의와 비즈니스 영역 내에서 눈으로 보여지기 힘든 부분을 다루는 경우가 많습니다. 그럼에도 불구하고 Backend 의 영역은 비즈니스와 직접적으로 연관되어 있는 경우가 많기에 난해해질 수 있는 가능성을 항상 가지고 있으며 Application 이 진화하는 과정에서 가장 변화가 심한 부분일 수 있습니다. 단지 Frontend 의 그것 처럼 눈에 보이지 않을 뿐입니다.</p> <p>이 섹션에서는 인프라와 기본적인 비즈니스 요구사항에서 대해서만 다루겠습니다. 비즈니스의 변화되는 과정은 후반부에 다뤄지는 섹션에서 더 자세하게 살펴볼 수 있을 것 같습니다.</p> <h3 id="todo-webapi-restful"><a href="#todo-webapi-restful" class="header-anchor">#</a> Todo WebAPI(RESTful)</h3> <ul><li><a href="https://dotnet.microsoft.com/download" target="_blank" rel="noopener noreferrer">dotnet core sdk<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
mac 혹은 linux 에서 sdk 설치에 대해서는 <a href="../dev-log/dotnetcore">dotnet core in CentOS 8 &amp; mac</a> 참조해주시기 바랍니다.</li> <li>IDE Tools:<br> <a href="https://code.visualstudio.com/" target="_blank" rel="noopener noreferrer">Visual Studio Code<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> + C# extensions 또는<br> <a href="https://visualstudio.microsoft.com/ko/vs/" target="_blank" rel="noopener noreferrer">Visual Studio 2019 Community<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
여기서는 두 IDE 툴을 혼용해서 쓸 예정입니다. (아무래도 VSCode 가 Visual Studo 의 편의성을 아직 따라가진 못한다고 생각합니다. 물론 C# 개발에 한해서 말이죠.)</li> <li>.net core CLI 를 이용하여 프로젝트를 생성합니다. (Windows 개발 환경이라면 bash 환경을 이용할때 Git 설치 시 같이 설치되는 <strong>Git Bash</strong> 혹은 <a href="https://cmder.net/" target="_blank" rel="noopener noreferrer">Cmder<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 를 이용하시길 추천드립니다.)</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">mkdir</span> todoCore3 <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> todoCore3
$ dotnet new sln <span class="token parameter variable">--name</span> todoCore3
$ dotnet new webapi <span class="token parameter variable">--name</span> todoCore3.Api
$ dotnet sln <span class="token function">add</span> todoCore3.Api/todoCore3.Api.csproj
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>추후 db 연결을 위하여 패키지 미리 설치하도록 하겠습니다.</li> <li>EF core 를 사용합니다.</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ dotnet <span class="token function">add</span> package Microsoft.EntityFrameworkCore.SqlServer
$ dotnet <span class="token function">add</span> package Microsoft.EntityFrameworkCore.InMemory <span class="token comment"># 간단한 테스트용도</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>Visual Studio 혹은 VisualStudio Code 등에서 <code>Ctrl+F5</code> 로 앱 실행 후 브라우저에서 <code>https://localhost:5001/weatherforecast</code> 접속하여 테스트 해봅니다.</li> <li><code>.gitignore</code> 추가 후 git repository 초기화합니다.</li> <li>참고: <a href="https://github.com/github/gitignore" target="_blank" rel="noopener noreferrer">gitignore github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">git</span> init
<span class="token comment"># git.shockz.io 는 개인 git 서버입니다. github 주소로 대체하시면 됩니다.</span>
$ <span class="token function">git</span> remote <span class="token function">add</span> origin https://git.shockz.io/shockz/todocore3.git
$ <span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
$ <span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">&quot;Initial commit&quot;</span>
$ <span class="token function">git</span> push <span class="token parameter variable">-u</span> origin master
$ <span class="token function">git</span> lfs <span class="token function">install</span>
$ <span class="token function">git</span> flow init
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>프로젝트 폴더의 <code>Startup.cs</code> 수정 합니다.
<ul><li>Configure 메서드 내의 <strong>app.UseHttpsRedirection();</strong> 제거<br>
https 리디렉션은 nginx 에서 처리할 예정이므로 필요하지 않습니다.</li> <li>ForwardHeaders 삽입 (추후 nginx reverse proxy 설정을 위해 필요합니다.)</li></ul></li></ul> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>app<span class="token punctuation">.</span><span class="token function">UseForwardedHeaders</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ForwardedHeadersOptions</span>
<span class="token punctuation">{</span>
    ForwardedHeaders <span class="token operator">=</span> ForwardedHeaders<span class="token punctuation">.</span>XForwardedFor <span class="token operator">|</span> ForwardedHeaders<span class="token punctuation">.</span>XForwardedProto
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>여기서 만들어지는 Todo App 은 nginx reverse proxy 를 이용하여 docker container 형태로 구동이 될 예정이므로 디버깅 환경을 비슷하게 하기 위하여 Kestrel 웹 서버 방식을 사용할 예정입니다.
Kestrel 웹서버 방식으로 테스트하기 위해서는 Visual Studo 등의 디버깅 환경을 적절하게 조정해줘야 합니다. (<s>IIS Express 테스트하게 되면 인증서등의 문제가 좀 귀찮아 집니다.</s>)<br> <img src="data:image/png;base64,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" alt="kestrel"><br>
참고: <a href="https://docs.microsoft.com/ko-kr/aspnet/core/fundamentals/servers/kestrel?view=aspnetcore-3.1" target="_blank" rel="noopener noreferrer">ASP.NET Core에서 Kestrel 웹 서버 구현<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <ul><li><a href="https://www.postman.com/downloads/" target="_blank" rel="noopener noreferrer">Postman<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 등과 같은 툴로 기본적인 테스트를 진행합니다.<br> <img src="/assets/img/postman.test.1.8edecdd4.png" alt="postman"></li> <li>프로젝트에 <code>Models</code> 폴더를 생성하고 <code>TodoItem.cs</code> 모델을 추가합니다.</li></ul> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">namespace</span> <span class="token namespace">todoCore3<span class="token punctuation">.</span>Api<span class="token punctuation">.</span>Models</span>
<span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TodoItem</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">long</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
		<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
		<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsCompleted <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>기본적인 CRUD 테스트를 위해 <code>TodoContext.cs</code> 추가합니다.</li></ul> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>EntityFrameworkCore</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">todoCore3<span class="token punctuation">.</span>Api<span class="token punctuation">.</span>Models</span>
<span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TodoContext</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DbContext</span></span>
	<span class="token punctuation">{</span>
		<span class="token keyword">public</span> <span class="token function">TodoContext</span><span class="token punctuation">(</span><span class="token class-name">DbContextOptions<span class="token punctuation">&lt;</span>TodoContext<span class="token punctuation">&gt;</span></span> options<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>TodoItem<span class="token punctuation">&gt;</span></span> TodoItems <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>이제 SQL Server 가 필요한데 많은 예제들이 localdb 를 사용합니다.</li> <li>localdb 가 개발 및 테스트적인 측면에서는 편리한 면이 있으나 실제 프로덕션 레벨에서는 잘 사용하지 않습니다.</li> <li>그래서, SQL Server 에 대한 DbContext 마이그레이션도 필요하므로 container 형태로 생성하겠습니다. (<a href="../dev-log/mssql">mssql container 생성 참조</a>)</li> <li>기본 조건으로 생성해도 되지만 아래의 추가적인 조건들이 있습니다.
<ul><li>테스트 및 WebAPI 코드의 connection string 단순화를 위해 docker network 생성하여 연결합니다.<br> <code>docker network create todo-core</code></li> <li>data 보존을 위해서 docker data volume 을 이용합니다.<br> <code>docker volume create sql_data</code></li> <li>테스트의 편의성을 위해 기본 port 로 진행합니다.<br>
(port 변경 시 container 간 network는 추가 작업이 필요할 수 있습니다.)</li> <li>물론 이 모든 것들은 향후 <strong>docker-compose</strong>로 대체될 예정입니다.</li></ul></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># network 생성</span>
$ <span class="token function">docker</span> network create todo-core
$ <span class="token function">docker</span> network <span class="token function">ls</span>

<span class="token comment"># volume 생성</span>
$ <span class="token function">docker</span> volume create sql_data
$ <span class="token function">docker</span> volume <span class="token function">ls</span>

<span class="token comment"># sql container run</span>
$ <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">1433</span>:1433 <span class="token parameter variable">-e</span> <span class="token string">&quot;ACCEPT_EULA=Y&quot;</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;SA_PASSWORD=y0urStrong!Password&quot;</span> <span class="token parameter variable">--network</span><span class="token operator">=</span>todo-core <span class="token parameter variable">--name</span> sql <span class="token parameter variable">-v</span> sql_data:/var/opt/mssql mcr.microsoft.com/mssql/server:2019-latest

<span class="token comment"># 추후 백업을 위한 디렉토리 생성</span>
$ <span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-d</span> sql <span class="token function">mkdir</span> /var/opt/mssql/backup
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>Api 시작 시 db migration 을 위해 기본적인 코드 수정을 진행합니다.
<ul><li><code>Startup.cs</code> 의 <code>ConfigureServices()</code>에 <strong>DbContext</strong> DI(종속성 주입)</li> <li>프로젝트에 EntityFrameworkCore.Design 추가<br> <code>dotnet add package Microsoft.EntityFrameworkCore.Design</code></li> <li>ef core cli 설치</li> <li>migration 생성은 <a href="https://docs.microsoft.com/ko-kr/ef/core/miscellaneous/cli/powershell" target="_blank" rel="noopener noreferrer">패키지 관리자 콘솔<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>을 이용하는 방법과 CLI로 하는 방법이 있습니다. 이 Tutorial 에서는 CLI 이용합니다. (mac 이나 linux 에서 코드를 수정하는 경우도 있을 수 있으므로 CLI 방식이 더 효율적입니다.)</li></ul></li></ul> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContext</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TodoContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>opt <span class="token operator">=&gt;</span> opt<span class="token punctuation">.</span><span class="token function">UseSqlServer</span><span class="token punctuation">(</span><span class="token string">&quot;Data Source=localhost;Database=todos;Integrated Security=false;User ID=sa;Password=y0urStrong!Password;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token comment">// container 시작 시에 자동 migration을 위해 설정</span>
<span class="token comment">// 자동 마이그레이션을 사용하지 않을 경우 CLI 를 통해 migration 추가 및 update</span>
<span class="token comment">// NOTE: 이 방법은 nginx 를 통한 reverse proxy 를 사용하게 되면 제거해야 함.</span>
<span class="token comment">// docker-compose 로 api container 가 동시에 시작이 될 경우 문제가 될 수 있음</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IWebHostEnvironment</span> env<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
   <span class="token range operator">..</span><span class="token punctuation">.</span>
   <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> serviceScope <span class="token operator">=</span> app<span class="token punctuation">.</span>ApplicationServices<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetRequiredService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IServiceScopeFactory<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">CreateScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">var</span></span> context <span class="token operator">=</span> serviceScope<span class="token punctuation">.</span>ServiceProvider<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TodoContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>Database<span class="token punctuation">.</span><span class="token function">GetPendingMigrations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
         <span class="token comment">// DB update migrations</span>
         context<span class="token punctuation">.</span>Database<span class="token punctuation">.</span><span class="token function">Migrate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># ef core 를 위한 tool 업데이트</span>
$ dotnet tool <span class="token function">install</span> <span class="token parameter variable">--global</span> dotnet-ef
<span class="token comment"># or</span>
$ dotnet tool update <span class="token parameter variable">-g</span> dotnet-ef

<span class="token comment"># migration 생성</span>
$ dotnet ef migrations <span class="token function">add</span> CreateTodoItem <span class="token parameter variable">--project</span> todoCore3.Api.csproj
<span class="token comment"># migration 취소</span>
$ dotnet ef migrations remove
<span class="token comment"># db update</span>
$ dotnet ef database update <span class="token parameter variable">--project</span> todoCore3.Api.csproj
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li><p>DB tool을 이용해 확인합니다.</p> <blockquote><p><a href="https://docs.microsoft.com/ko-kr/sql/azure-data-studio/download-azure-data-studio?view=sql-server-ver15" target="_blank" rel="noopener noreferrer">Azure Data Studio<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 혹은 <a href="https://docs.microsoft.com/ko-kr/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-ver15" target="_blank" rel="noopener noreferrer">SSMS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <img src="/assets/img/efcore.1.15313c2f.png" alt="efcore"> <img src="data:image/png;base64,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" alt="efcore"></p></blockquote></li> <li><p>api Controller scaffolding (선택사항)<br>
IDE 를 이용하거나 수동으로 직접 추가해도 됩니다.</p></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ dotnet <span class="token function">add</span> package Microsoft.VisualStudio.Web.CodeGeneration.Design
$ dotnet tool <span class="token function">install</span> <span class="token parameter variable">--global</span> dotnet-aspnet-codegenerator
$ dotnet tool update <span class="token parameter variable">-g</span> dotnet-aspnet-codegenerator
$ dotnet aspnet-codegenerator controller <span class="token parameter variable">-name</span> TodoItemsController <span class="token parameter variable">-async</span> <span class="token parameter variable">-api</span> <span class="token parameter variable">-m</span> TodoItem <span class="token parameter variable">-dc</span> TodoContext <span class="token parameter variable">-outDir</span> Controllers
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>코드가 제대로 반영되었는지 확인하기 위해 <strong>TodoItems Controller</strong>의 POST 메서드 부분을 수정해 봅니다.</li></ul> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-csharp"><code><span class="token comment">// POST: api/TodoItems</span>
<span class="token punctuation">[</span>HttpPost<span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ActionResult<span class="token punctuation">&lt;</span>TodoItem<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">PostTodoItem</span><span class="token punctuation">(</span><span class="token class-name">TodoItem</span> todoItem<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  _context<span class="token punctuation">.</span>TodoItems<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>todoItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> _context<span class="token punctuation">.</span><span class="token function">SaveChangesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//return CreatedAtAction(&quot;GetTodoItem&quot;, new { id = todoItem.Id }, todoItem);</span>
  <span class="token keyword">return</span> <span class="token function">CreatedAtAction</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>GetTodoItem<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> id <span class="token operator">=</span> todoItem<span class="token punctuation">.</span>Id <span class="token punctuation">}</span><span class="token punctuation">,</span> todoItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>Postman 에서 request body 에 아래를 추가하여 테스트 해봅니다.</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test Todo 1&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;IsCompleted&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="/assets/img/postman.test.4.7c08401f.png" alt="postman"> <img src="/assets/img/postman.test.5.52f1cba3.png" alt="postman"></p> <h3 id="dockerize"><a href="#dockerize" class="header-anchor">#</a> Dockerize</h3> <p>여기서는 도커에 대한 세부적인 설명은 하지 않습니다. 검색해보면 굉장히 질 좋은 자료들이 많습니다. (<s>역시 코딩은 구글검색으로 다 합니다.(모두의 코~딩~) 역시 개발자의 능력은 컨트롤 C + V</s>)<br>
프로덕션 단계에서도 Docker를 이용하여 배포할 예정이므로 개발 환경 자체도 Docker 베이스로 구현하는것이 좋습니다.</p> <ul><li><code>Api.Dockerfile</code> 을 프로젝트 폴더에 추가합니다. .net core 를 컨테이너로 구동시키기 위해 필요합니다.</li></ul> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> mcr.microsoft.com/dotnet/core/aspnet:3.1 <span class="token keyword">AS</span> base</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span>

<span class="token instruction"><span class="token keyword">FROM</span> mcr.microsoft.com/dotnet/core/sdk:3.1 <span class="token keyword">AS</span> build</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /src</span>
<span class="token instruction"><span class="token keyword">COPY</span> [<span class="token string">&quot;todoCore3.Api.csproj&quot;</span>, <span class="token string">&quot;./&quot;</span>]</span>
<span class="token instruction"><span class="token keyword">RUN</span> dotnet restore <span class="token string">&quot;./todoCore3.Api.csproj&quot;</span></span>
<span class="token instruction"><span class="token keyword">COPY</span> . .</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> <span class="token string">&quot;/src/.&quot;</span></span>
<span class="token instruction"><span class="token keyword">RUN</span> dotnet build <span class="token string">&quot;todoCore3.Api.csproj&quot;</span> -c Release -o /app/build</span>

<span class="token instruction"><span class="token keyword">FROM</span> build <span class="token keyword">AS</span> publish</span>
<span class="token instruction"><span class="token keyword">RUN</span> dotnet publish <span class="token string">&quot;todoCore3.Api.csproj&quot;</span> -c Release -o /app/publish</span>

<span class="token instruction"><span class="token keyword">FROM</span> base <span class="token keyword">AS</span> final</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span>
<span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">publish</span></span> /app/publish .</span>
<span class="token instruction"><span class="token keyword">ENV</span> ASPNETCORE_URLS http://*:5000</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;dotnet&quot;</span>, <span class="token string">&quot;todoCore3.Api.dll&quot;</span>]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ul><li>docker container 간 network 설정을 하게 되므로 연결 문자열에서 서버 연결 부분을 도커 컨테이너 이름으로 변경해줍니다.<br> <code>Data Source=(docker container name);Database=todos;Integrated Security=false;User ID=sa;Password=y0urStrong!Password;</code></li></ul> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContext</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TodoContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>opt <span class="token operator">=&gt;</span> opt<span class="token punctuation">.</span><span class="token function">UseSqlServer</span><span class="token punctuation">(</span><span class="token string">&quot;Data Source=sql;Database=todos;Integrated Security=false;User ID=sa;Password=y0urStrong!Password;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>build &amp; run</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> build <span class="token parameter variable">-t</span> todo-api <span class="token parameter variable">-f</span> Api.Dockerfile <span class="token builtin class-name">.</span>
$ <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">5000</span>:5000 <span class="token parameter variable">--network</span><span class="token operator">=</span>todo-core <span class="token parameter variable">--name</span> todo-api todo-api
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/assets/img/postman.test.2.d6238b28.png" alt="postman"> <img src="/assets/img/postman.test.3.4b5317e7.png" alt="postman"></p> <h3 id="nginx-reverse-proxy"><a href="#nginx-reverse-proxy" class="header-anchor">#</a> Nginx reverse proxy</h3> <p>현재 Todo App 의 WebAPI 는 Kestrel 서버로 구현이 되어 있습니다. 부족한 웹서버 기능을 보완하기 위해 Nginx 를 사용하겠습니다. 또한 Nginx 를 통해 기본적인 load balancing 을 구현할 예정이므로 docker-compose 도 사용하도록 합니다.</p> <ul><li>솔루션 폴더에 Nginx 폴더 추가 후 <code>Nginx.Dockerfile</code>, <code>nginx.conf</code> 생성합니다.</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">mkdir</span> Nginx <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> Nginx
$ <span class="token function">touch</span> Nginx.Dockerfile nginx.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><strong>Nginx.Dockerfile</strong>를 추가합니다.</li></ul> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> nginx:latest</span>

<span class="token instruction"><span class="token keyword">COPY</span> nginx.conf /etc/nginx/nginx.conf</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><strong>nginx.conf</strong>를 추가해줍니다.</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>worker_processes auto<span class="token punctuation">;</span>

events <span class="token punctuation">{</span> worker_connections <span class="token number">2048</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
  sendfile on<span class="token punctuation">;</span>

  upstream web-api <span class="token punctuation">{</span>
    server api_1:5000<span class="token punctuation">;</span> <span class="token comment"># docker-compose 에서 사용될 service 이름</span>
  <span class="token punctuation">}</span>

  server <span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name <span class="token variable">$hostname</span><span class="token punctuation">;</span>
    location / <span class="token punctuation">{</span>
      proxy_pass         http://web-api<span class="token punctuation">;</span>
      proxy_redirect     off<span class="token punctuation">;</span>
      proxy_http_version <span class="token number">1.1</span><span class="token punctuation">;</span>
      proxy_cache_bypass <span class="token variable">$http_upgrade</span><span class="token punctuation">;</span>
      proxy_set_header   Upgrade <span class="token variable">$http_upgrade</span><span class="token punctuation">;</span>
      proxy_set_header   Connection keep-alive<span class="token punctuation">;</span>
      proxy_set_header   Host <span class="token variable">$host</span><span class="token punctuation">;</span>
      proxy_set_header   X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
      proxy_set_header   X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
      proxy_set_header   X-Forwarded-Proto <span class="token variable">$scheme</span><span class="token punctuation">;</span>
      proxy_set_header   X-Forwarded-Host <span class="token variable">$server_name</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><ul><li>솔루션 폴더에 <code>docker-compose.yml</code> 추가합니다.</li></ul> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code>version: &quot;3.7&quot;

services:
  sql:
    image: mcr.microsoft.com/mssql/server:2019-latest
    ports:
      - &quot;1433:1433&quot;
    volumes:
      - &quot;sql_data:/var/opt/mssql&quot;
    environment:
      ACCEPT_EULA: &quot;Y&quot;
      SA_PASSWORD: &quot;y0urStrong!Password&quot;
    restart: &quot;no&quot;

  nginx:
    depends_on:
      - sql
      - api_1
    build:
      context: ./Nginx
      dockerfile: Nginx.Dockerfile
    ports:
      - &quot;4000:80&quot;
    restart: &quot;no&quot;

  api_1:
    depends_on:
      - sql
    build:
      context: ./todoCore3.Api
      dockerfile: Api.Dockerfile
    expose:
      - &quot;5000&quot;
    restart: &quot;no&quot;

volumes:
  sql_data:
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p><a href="https://github.com/vishnubob/wait-for-it/" target="_blank" rel="noopener noreferrer">wait-for-it.sh<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>특정 서버의 특정 포트로 접근이 가능할때까지 프로세스를 홀딩하는 스크립트<br>
sql container가 초기화 될때까지 대기하고 있다가 api 가 실행되게 하기 위해서 120초 대기하다가 실행되도록 함</p></blockquote> <ul><li><p>SQL server 를 컨테이너로 구동시키게 되는데 api 컨테이너들이 SQL server 접속을 시도하게 되면 api 컨테이너가 exception 발생이 많아져 구동이 안되는 경우가 생길 수 있습니다.</p></li> <li><p>물론 이를 해결하는 방법에는 여러가지가 있습니다만 구현의 단순함을 위해 해당 SQL server 가 구동이 될때까지 기다리기 위해 <strong>wait-for-it.sh</strong> 를 사용합니다.</p></li> <li><p><code>Api.Dockerfile</code>을 수정합니다.</p></li></ul> <div class="language-docker line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> mcr.microsoft.com/dotnet/core/aspnet:3.1 <span class="token keyword">AS</span> base</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span>

<span class="token instruction"><span class="token keyword">FROM</span> mcr.microsoft.com/dotnet/core/sdk:3.1 <span class="token keyword">AS</span> build</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /src</span>
<span class="token instruction"><span class="token keyword">COPY</span> [<span class="token string">&quot;todoCore3.Api.csproj&quot;</span>, <span class="token string">&quot;./&quot;</span>]</span>
<span class="token instruction"><span class="token keyword">RUN</span> dotnet restore <span class="token string">&quot;./todoCore3.Api.csproj&quot;</span></span>
<span class="token instruction"><span class="token keyword">COPY</span> . .</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> <span class="token string">&quot;/src/.&quot;</span></span>
<span class="token instruction"><span class="token keyword">RUN</span> dotnet build <span class="token string">&quot;todoCore3.Api.csproj&quot;</span> -c Release -o /app/build</span>

<span class="token instruction"><span class="token keyword">FROM</span> build <span class="token keyword">AS</span> publish</span>
<span class="token instruction"><span class="token keyword">RUN</span> dotnet publish <span class="token string">&quot;todoCore3.Api.csproj&quot;</span> -c Release -o /app/publish</span>

<span class="token instruction"><span class="token keyword">FROM</span> base <span class="token keyword">AS</span> final</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span>
<span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">publish</span></span> /app/publish .</span>
<span class="token instruction"><span class="token keyword">ENV</span> ASPNETCORE_URLS http://*:5000</span>
<span class="token instruction"><span class="token keyword">COPY</span> ./wait-for-it.sh /wait-for-it.sh</span>
<span class="token instruction"><span class="token keyword">RUN</span> chmod +x /wait-for-it.sh</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;/wait-for-it.sh&quot;</span>, <span class="token string">&quot;sql:1433&quot;</span>, <span class="token string">&quot;-t&quot;</span>, <span class="token string">&quot;120&quot;</span>, <span class="token string">&quot;--&quot;</span>, <span class="token string">&quot;dotnet&quot;</span>, <span class="token string">&quot;todoCore3.Api.dll&quot;</span>]</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></div> <div class="custom-block danger"><p class="custom-block-title">DANGER</p> <p>위에서 구현했던 db migration 부분은 문제가 있습니다.<br> <code>docker-compose up --build</code> 로 최초로 실행하거나 DB 스키마가 변경되었을 경우 <code>TodoContext</code> 에 대한 DB 마이그레이션이 업데이트 되기 전인 상태가 되므로 다른 방법이 필요합니다.  <code>Startup.cs/Configure()</code> 메서드 내의 <strong>Migration</strong> 관련 코드를 제거하고,
컨테이너가 실행되기 전 db migration script 를 실행하는 방법으로 변경할 예정입니다.</p></div> <ul><li>docker-compose 로 실행합니다.</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker-compose</span> up <span class="token parameter variable">--build</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>Postman 으로 테스트해보면,
<img src="/assets/img/postman.test.6.b15a0e5d.png" alt="postman"> <img src="/assets/img/postman.test.7.95b05420.png" alt="postman"> <img src="/assets/img/postman.test.8.4c3a9b4a.png" alt="postman"></li></ul> <h3 id="ssl-적용"><a href="#ssl-적용" class="header-anchor">#</a> SSL 적용</h3> <ul><li>dotnet SDK 를 설치하거나 Visual Studio 를 통해 디버깅을 하게 되면 보통 자체 서명 인증서 등록되어 있으므로 그것을 이용하겠습니다.<br> <img src="/assets/img/certificate.1.73fd9ce2.png" alt="certificate"> <img src="data:image/png;base64,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RKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmag5EoOZqDkSg5moORKDmQ2o+y48/wMSoOcCioOYAEag5QARqDhCBmgNEoOYAEag5QARqDhCBmgNEoOYAEag5QARqDhCBmgOD3HrrrU0fwmL3mte8ZpTd1BwYJK358uXLmz6KxWvnzp1qruYwAWreLDVXc5gMNW+Wmqs5TIaaN0vN1Rwm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" alt="certificate"></li> <li><code>localhost.pfx</code>로 <em>내보내기</em> 후 <strong>Nginx</strong> 폴더에 저장
<img src="/assets/img/certificate.3.2a9fed55.png" alt="certificate"> <img src="/assets/img/certificate.4.e0bc1a08.png" alt="certificate"> <img src="/assets/img/certificate.5.0a94b1c7.png" alt="certificate"> <img src="/assets/img/certificate.6.2d71679a.png" alt="certificate"> <img src="/assets/img/certificate.7.d8c90bc5.png" alt="certificate"> <img src="data:image/png;base64,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LACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQEgsAISQWAEJILACEkFgACCGxABBCYgEghMQCQAiJBYAQQ0zsu971rnYfOQAMa3ffffdQEnvUUUe1+8gBYFi76aabJBYAWk9iASCExAJACIkFgBASCwAhJBYAQkgsAISQWAAIIbEAgXb92mPtPoRYz3x+z3q/+sUvftHuo4v13ve+t/EKEgsQaIQn9sADD2z3AUa55557JBagnbLEPvypndp9IK2396UvJBLbkMQCBJLYdh9mFIkFaDOJbfdhRpFYgDYbWmJ/v+SEI865t//29C/fct3cfVacfcJD89P/NlgzW3HbnFq7Epue8qI3X3fekb03V5y9901HPZzfLK52ZnJh3LMhsQBtNuTEluShJrHdfV17WjEvaW++Mamysr0rzX8obXFSLHDv7h6qk6gBbevEpuc25+rKu2Ytffi8pM7xd6+eLB3KiTVHYgHarN2JzYd83Qtrp1yd9Nco313VsLBZbRrFdp/0spn951g6is2emaXJnOoXHK0jsQBtFprYZMCJ4v5Nejp64aRv9De5sLuyPQ+oHYntHpo+8OWlM5fNOWdK7wi1NrHF8Wu2QURmJRagzVqb2GymtPk3XFecfXZyXlaf3qHqm/v3XOzqUBq7jRPbc/b9p569tpi19OGjbupPbPYMzaqaHs5XbemkscQCtFnUKLbkjckKPUEpbpDPBuejvtLfDsIwuaLY5U4AI1T0RHFDdSLaG6WkuLvCeLdZ2zSx1ddY95m1dGkyR2IBRqLWfGgn6RmWHnVTyeVONd0pTCPXG6dm9Tlt7ZkdOYr1oR0AurXyqyfKriiuDmPFOlVZLaybXV/8wKQOei+23ln3J7apyfOWHYbEArRZWxNbXKF63YpLbTvmiuKSs14x1M/1biWJBWiz6MQ2nChOmoznkAorsRIL0Fbt/47ingQlV8+p9/uls5KhfT/DMLmiuF0kFqDN2p/YMBIrsQDtJLHtPswoEgvQZllit2MS24DEAgQa4Ylt99HFklgAaI8ssRN6lCc272uW2NRdd90lsQDQWJrYiRMnpqPYPLGpHXbYoTqx2c9sFCuxADCgLLH5KDYdv5YktjhRnLrzzjslFgAaSxM7adKk4ig2rWx/Yjds2FA1ik2tXLlSYgGgsTSxkydPzhNbHMWOSmWJzUexmzdvThN7xx13SCwANJYmdsqUKeN7VI1iKxKbVTZL7O233y6xANBYmti3vvWteWKzy4krJoq7urqqEnvbbbdJLAA0liV2woQJVYlNR7Ddid24cWMa16yyeWJvvfVWiQWAxtLETp06tSqxY8aM6Z0oThOb9TX9mSf2lltukVgAaCxN7Nve9rZsojj/UGw2iu22adOmfBSbX1S8YsWKdh92v1tvX3XQuw7Illfd/U+Hv/ugBiunJ1Jc6OqTnVr+MiJ/+zn7bXFDAIYszUpxYVSf7L3JdHiX5icb5PW+W1m5fifaf//9x/XIr3XqH8WmQa0dxaYLaXrTAW66nN6TXWycrpO0I0V/d8U1J/3PD2TL1/zop5+YfVLpalWlzMuaLmdnt7lHdo7ZQlbZ0s0BGJS8qcV7in3doWBMj+z+epsPK1WvGLKTyl4xpNK4ZolNlysmiouJzZKTZTWVVrZYo2KEtmWKFi/53qwTj8uWr772hnlz/7x0tdLEFuUvFLLXENm4ti1nBLC9qipl1RA2a1KW29JR7DBMbOkZZbIzGluQFTc/td7EFidU82Frmtj8u4vbOKH67cVXfvQjH8qWr/r+j0+d97HS1WqniJPKieKssvn3bJgoBmi5YpCqxnx5aPOf2a+SmunlYaj0vIqvG7LBa8UscSoNalVi8whl71nmQ9h2peiSby/5+Ec/nC1fftUPTj91br01a8fZxdDmTa3tKwCtVaxmlpz8ZxahpK9VyTAewladTukbzHloi7PfvWumHU0qp1W31GjvUO/CS7578pze918vW3rNmaefUm/NBgPZpBDa/BxLtwJgaGoHo8Um9U+fFiSdMIStOpf8Zv6ioThArzi1l19+YOGhF0y5/dKjsxT9w6k7/tllhX3+t/Puu+lTyaVHfTK59GeffEvPXds4Recv/M78ubOy5UVLrj5rwScbrFyvsklla5Oea6CqNgGgJUrfYS0ta0f0tcmXDtV9TaWJvfjdF0y+7dL316QojdDPPvOeB864+TPJN//7Kcl3f/Hpt7Tj3L729W+fespfZMvf/u7ff/5zpzZYudjLxoPaRFwBIlVdXZwUKltvhWGu9KVDbVn7f27Z8uDCQ8+fcvt3ion93SWHXTDp1m8d3fWzTx/x4Jm3fKbrkiPmJktuOW3fdpzS35z/zU/P+2i2/K3FV/3vsz7TeP3SyiZlVw5LLECc0sQ2+G2naP6lQ5bY7oni9/dtkIZnXe/ANk3tnGTpbad1XXz4x5PLbz29LYk99/9+4zPze68i/uaiK7/wv04bcJOqdjbOqtACtFZtMhsEtbP6mgzmpcP/B3bWJILKQTUAAAAAAElFTkSuQmCC" alt="certificate"></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Windows 환경에서 자체 서명 인증서 발급 방법에 대해서는 아래의 주소를 참고합니다.<br> <a href="../dev-log/ssl">Windows</a></p></div> <ul><li>pfx 파일에서 crt, key 파일을 추출합니다.</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 키 파일 추출</span>
<span class="token comment"># [주의] PEM 패스워드를 지정하면, container 로 로딩시점에서 패스워드 입력을 요청하므로,</span>
<span class="token comment"># 패스워드를 입력한 상태로 키 추출 후 패스워드 제거</span>
$ openssl pkcs12 <span class="token parameter variable">-in</span> localhost.pfx <span class="token parameter variable">-nocerts</span> <span class="token parameter variable">-out</span> localhost_with_key.key
$ openssl rsa <span class="token parameter variable">-in</span> localhost_with_key.key <span class="token parameter variable">-out</span> localhost.key
<span class="token comment"># 인증서 파일 추출</span>
$ openssl pkcs12 <span class="token parameter variable">-in</span> localhost.pfx <span class="token parameter variable">-nokeys</span> <span class="token parameter variable">-clcerts</span> <span class="token parameter variable">-out</span> localhost.crt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><code>Nginx.Dockerfile</code> 에서 컨테이너 구동 시 인증서를 복사합니다.</li></ul> <div class="language-docker line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> nginx:latest</span>

<span class="token instruction"><span class="token keyword">COPY</span> nginx.conf /etc/nginx/nginx.conf</span>
<span class="token instruction"><span class="token keyword">COPY</span> localhost.crt /etc/ssl/certs/localhost.crt</span>
<span class="token instruction"><span class="token keyword">COPY</span> localhost.key /etc/ssl/private/localhost.key</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><code>nginx.conf</code> 에서 인증서를 적용하여 SSL로 접속되도록 수정합니다.</li></ul> <div class="language-bash line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-bash"><code>worker_processes auto<span class="token punctuation">;</span>

events <span class="token punctuation">{</span> worker_connections <span class="token number">2048</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
  sendfile on<span class="token punctuation">;</span>

  upstream web-api <span class="token punctuation">{</span>
    server api_1:5000<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  server <span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name localhost<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span>
      <span class="token builtin class-name">return</span> <span class="token number">301</span> https://<span class="token variable">$host</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  server <span class="token punctuation">{</span>
    listen <span class="token number">443</span> ssl<span class="token punctuation">;</span>
    server_name localhost<span class="token punctuation">;</span>

      ssl_certificate /etc/ssl/certs/localhost.crt<span class="token punctuation">;</span>
      ssl_certificate_key /etc/ssl/private/localhost.key<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span>
      proxy_pass         http://web-api<span class="token punctuation">;</span>
      proxy_redirect     off<span class="token punctuation">;</span>
      proxy_http_version <span class="token number">1.1</span><span class="token punctuation">;</span>
      proxy_cache_bypass <span class="token variable">$http_upgrade</span><span class="token punctuation">;</span>
      proxy_set_header   Upgrade <span class="token variable">$http_upgrade</span><span class="token punctuation">;</span>
      proxy_set_header   Connection keep-alive<span class="token punctuation">;</span>
      proxy_set_header   Host <span class="token variable">$host</span><span class="token punctuation">;</span>
      proxy_set_header   X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
      proxy_set_header   X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
      proxy_set_header   X-Forwarded-Proto <span class="token variable">$scheme</span><span class="token punctuation">;</span>
      proxy_set_header   X-Forwarded-Host <span class="token variable">$server_name</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><div class="custom-block danger"><p class="custom-block-title">DANGER</p> <p>현재 컨테이너 들은 4000(http), 4001(https) 프토로 매핑했기 때문에 http -&gt; https 리디렉션이 정상적으로 동작하지 않습니다. 이는 nginx.conf 의 설정을 수정해야 하는 문제가 있습니다.
이 부분은 추후 적용할 예정입니다.<br>
참고: <a href="https://stackoverflow.com/questions/15429043/how-to-redirect-on-the-same-port-from-http-to-https-with-nginx-reverse-proxy" target="_blank" rel="noopener noreferrer">StackOverflow<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <ul><li><code>docker-compose.yml</code> 도 수정합니다.</li></ul> <div class="language-docker line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-docker"><code>version: &quot;3.7&quot;

services:
  sql:
    image: mcr.microsoft.com/mssql/server:2019-latest
    ports:
      - &quot;1433:1433&quot;
    volumes:
      - &quot;sql_data:/var/opt/mssql&quot;
    environment:
      ACCEPT_EULA: &quot;Y&quot;
      SA_PASSWORD: &quot;p@ssw0rd&quot;
    restart: &quot;no&quot;

  nginx:
    depends_on:
      - sql
      - api_1
    build:
      context: ./Nginx
      dockerfile: Nginx.Dockerfile
    ports:
      - &quot;4000:80&quot;
      - &quot;4001:443&quot;
    restart: &quot;no&quot;

  api_1:
    depends_on:
      - sql
    build:
      context: ./todoCore3.Api
      dockerfile: Api.Dockerfile
    expose:
      - &quot;5000&quot;
    restart: &quot;no&quot;

volumes:
  sql_data:
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><ul><li><code>docker-compose up</code></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker-compose</span> down
$ <span class="token function">docker-compose</span> build
$ <span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>브라우저 테스트<br> <img src="/assets/img/certificate.9.5f5c3177.png" alt="certificate"></li> <li><strong>Postman</strong> 테스트
<img src="/assets/img/postman.test.9.5f7953db.png" alt="postman"> <img src="/assets/img/postman.test.10.58d87a09.png" alt="postman"> <img src="/assets/img/postman.test.11.b2af8975.png" alt="postman"></li></ul> <h3 id="improvements-fix"><a href="#improvements-fix" class="header-anchor">#</a> Improvements &amp; Fix</h3> <p>여기까지 만들어진 Api 에는 몇 가지 고민해야할 문제들이 있습니다. 개발 및 테스트 단계에서는 프로그래밍 방식으로 DB 마이그레이션 하는 것이 생산성 측면에서는 좋을 수 있으나 프로덕션 레벨에서는 치명적인 문제를 발생시킬 수 있습니다.<br>
예를 들어</p> <ul><li>api 인스턴스를 여러 개 실행하는 경우:<br>
인스턴스들이 동시에 마이그레이션을 적용하려고 시도함으로서 실패 가능성 내포</li> <li>CI 프로세스의 일부로서 배포 시나리오가 동작하는 경우 관리 용이성이 떨어짐</li> <li>사전 검증 불가능으로 인한 데이터 유실의 위험</li></ul> <p>그 외에도 각 endpoint 에 대한 과도한 정보 노출, 아키텍쳐 측면의 한계 등이 있을 수 있습니다.</p> <p>일단 현재 단계에서는 아래의 부분을 개선하고, 차차 진행하면서 추가적인 이슈가 나올 경우 개선해보도록 하겠습니다.</p> <ul><li>SQL 스크립트를 통한 DB 마이그레이션 적용</li> <li>실제 도메인(*.shockz.io) 을 통한 SSL 적용</li> <li>DTO 시나리오 적용</li></ul> <h3 id="sql-migration-script-적용"><a href="#sql-migration-script-적용" class="header-anchor">#</a> SQL migration script 적용</h3> <ul><li>마이그레이션 추가를 위해 <code>TodoItem</code> 모델에 TimeStamp 추가합니다.</li></ul> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-csharp"><code>  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TodoItem</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">long</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsCompleted <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Timestamp</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> RowVersion <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 마이그레이션 추가</span>
$ dotnet ef migrations <span class="token function">add</span> AddTimeStamp
<span class="token comment"># 마이그레이션 리스트</span>
$ dotnet ef migrations list
$ dotnet ef migrations script <span class="token parameter variable">--idempotent</span> <span class="token parameter variable">-o</span> migrations01.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><code>migrations01.sql</code> 확인<br>
idempotent 옵션으로 생성했기 때문에 각 마이그레이션 체크 후 실행될 수 있도록 스크립트 생성됩니다.</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">IF</span> OBJECT_ID<span class="token punctuation">(</span>N<span class="token string">'[__EFMigrationsHistory]'</span><span class="token punctuation">)</span> <span class="token operator">IS</span> <span class="token boolean">NULL</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span>__EFMigrationsHistory<span class="token punctuation">]</span> <span class="token punctuation">(</span>
        <span class="token punctuation">[</span>MigrationId<span class="token punctuation">]</span> nvarchar<span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>ProductVersion<span class="token punctuation">]</span> nvarchar<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
        <span class="token keyword">CONSTRAINT</span> <span class="token punctuation">[</span>PK___EFMigrationsHistory<span class="token punctuation">]</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>MigrationId<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>

GO

<span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">[</span>__EFMigrationsHistory<span class="token punctuation">]</span> <span class="token keyword">WHERE</span> <span class="token punctuation">[</span>MigrationId<span class="token punctuation">]</span> <span class="token operator">=</span> N<span class="token string">'20200909112636_CreateTodoItem'</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span>TodoItems<span class="token punctuation">]</span> <span class="token punctuation">(</span>
        <span class="token punctuation">[</span>Id<span class="token punctuation">]</span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">IDENTITY</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>Name<span class="token punctuation">]</span> nvarchar<span class="token punctuation">(</span>max<span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>IsCompleted<span class="token punctuation">]</span> <span class="token keyword">bit</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
        <span class="token keyword">CONSTRAINT</span> <span class="token punctuation">[</span>PK_TodoItems<span class="token punctuation">]</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>Id<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>

GO

<span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">[</span>__EFMigrationsHistory<span class="token punctuation">]</span> <span class="token keyword">WHERE</span> <span class="token punctuation">[</span>MigrationId<span class="token punctuation">]</span> <span class="token operator">=</span> N<span class="token string">'20200909112636_CreateTodoItem'</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">[</span>__EFMigrationsHistory<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>MigrationId<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>ProductVersion<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>N<span class="token string">'20200909112636_CreateTodoItem'</span><span class="token punctuation">,</span> N<span class="token string">'3.1.8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>

GO

<span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">[</span>__EFMigrationsHistory<span class="token punctuation">]</span> <span class="token keyword">WHERE</span> <span class="token punctuation">[</span>MigrationId<span class="token punctuation">]</span> <span class="token operator">=</span> N<span class="token string">'20200912110359_AddTimeStamp'</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span>TodoItems<span class="token punctuation">]</span> <span class="token keyword">ADD</span> <span class="token punctuation">[</span>RowVersion<span class="token punctuation">]</span> rowversion <span class="token boolean">NULL</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>

GO

<span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">[</span>__EFMigrationsHistory<span class="token punctuation">]</span> <span class="token keyword">WHERE</span> <span class="token punctuation">[</span>MigrationId<span class="token punctuation">]</span> <span class="token operator">=</span> N<span class="token string">'20200912110359_AddTimeStamp'</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">[</span>__EFMigrationsHistory<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>MigrationId<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>ProductVersion<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>N<span class="token string">'20200912110359_AddTimeStamp'</span><span class="token punctuation">,</span> N<span class="token string">'3.1.8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>

GO
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><ul><li><code>Startup.cs</code>에서 DB migration 하는 부분은 삭제합니다.</li></ul> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IWebHostEnvironment</span> env<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
  <span class="token comment">//using (var serviceScope = app.ApplicationServices.GetRequiredService&lt;IServiceScopeFactory&gt;().CreateScope())</span>
  <span class="token comment">//{</span>
  <span class="token comment">//	var context = serviceScope.ServiceProvider.GetService&lt;TodoContext&gt;();</span>

  <span class="token comment">//	if (context.Database.GetPendingMigrations().Any())</span>
  <span class="token comment">//	{</span>
  <span class="token comment">//		context.Database.Migrate();</span>
  <span class="token comment">//	}</span>
  <span class="token comment">//}</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>생성된 스크립트는 <a href="https://docs.microsoft.com/ko-kr/sql/azure-data-studio/download-azure-data-studio?view=sql-server-ver15" target="_blank" rel="noopener noreferrer">Azure Data Studio<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 혹은 <a href="https://docs.microsoft.com/ko-kr/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-ver15" target="_blank" rel="noopener noreferrer">SSMS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 등을 통해 수동으로 마이그레이션 합니다.</li> <li>추후 production level 에서는 App Instance 실행 시점에서 마이그레이션 하는 것이 아닌 수동으로 마이그레이션 하는 것이 좋습니다.<br> <a href="https://docs.microsoft.com/ko-kr/ef/core/managing-schemas/migrations/applying?tabs=dotnet-core-cli#apply-migrations-at-runtime" target="_blank" rel="noopener noreferrer">런타임에 마이그레이션 적용<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <img src="/assets/img/migrations.1.f75a9f07.png" alt="migrations"> <img src="/assets/img/migrations.2.6050fa21.png" alt="migrations"></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>개발 및 테스트 단계에서는 편의성을 위해 SQL Server를 1433 포트로 노출 시키지만, 프로덕션 레벨에서는 보안상의 이유로 SQL Server 를 외부에 노출시키지 않는 것이 좋습니다.<br>
언제든지 <code>docker-compose.yml</code> 에서 sql 서비스의 포트 매핑을 제거하고 expose로 변경하면 됩니다.</p> <div class="language-docker line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-docker"><code>  sql:
    image: mcr.microsoft.com/mssql/server:2019-latest
    expose:
      - &quot;1433&quot;
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div> <ul><li>docker-compose 빌드 및 실행</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker-compose</span> down
$ <span class="token function">docker-compose</span> up <span class="token parameter variable">--build</span> <span class="token parameter variable">-d</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>마이그레이션 이후 Postman 등으로 테스트 하게 되면 추가된 필드를 확인할 수 있습니다.
<img src="/assets/img/postman.test.12.016f59f3.png" alt="postman"></li></ul> <h3 id="dto-사용"><a href="#dto-사용" class="header-anchor">#</a> DTO 사용</h3> <ul><li>DTO(Data Transfer Object)를 사용하는 이유는 일반적으로 클라이언트에 보여지는 속성에 대한 제어를 하기 위함입니다.</li> <li>추후 이 부분은 Automapper Profile 등으로 변경할 예정입니다.</li> <li><strong>Models</strong> 폴더에 TodoItemDTO를 추가합니다. (전달할 데이터 속성만 정의합니다.)</li></ul> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TodoItemDTO</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">long</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsComplete <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>DTO 적용을 위하여 <code>TodoItemController</code>를 전반적으로 수정합니다.</li></ul> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><div class="highlighted"> </div><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-csharp"><code><span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">TodoItemExists</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">long</span></span> id<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _context<span class="token punctuation">.</span>TodoItems<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Id <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name">TodoItemDTO</span> <span class="token function">ItemToDTO</span><span class="token punctuation">(</span><span class="token class-name">TodoItem</span> todoItem<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TodoItemDTO</span>
<span class="token punctuation">{</span>
  Id <span class="token operator">=</span> todoItem<span class="token punctuation">.</span>Id<span class="token punctuation">,</span>
  Name <span class="token operator">=</span> todoItem<span class="token punctuation">.</span>Name<span class="token punctuation">,</span>
  IsComplete <span class="token operator">=</span> todoItem<span class="token punctuation">.</span>IsCompleted
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// GET: api/TodoItems</span>
<span class="token punctuation">[</span>HttpGet<span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ActionResult<span class="token punctuation">&lt;</span>IEnumerable<span class="token punctuation">&lt;</span>TodoItemDTO<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetTodoItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">await</span> _context<span class="token punctuation">.</span>TodoItems<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> <span class="token function">ItemToDTO</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToListAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// GET: api/TodoItems/5</span>
<span class="token punctuation">[</span><span class="token function">HttpGet</span><span class="token punctuation">(</span><span class="token string">&quot;{id}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ActionResult<span class="token punctuation">&lt;</span>TodoItemDTO<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetTodoItem</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">long</span></span> id<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token class-name"><span class="token keyword">var</span></span> todoItem <span class="token operator">=</span> <span class="token keyword">await</span> _context<span class="token punctuation">.</span>TodoItems<span class="token punctuation">.</span><span class="token function">FindAsync</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>todoItem <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token function">ItemToDTO</span><span class="token punctuation">(</span>todoItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// PUT: api/TodoItems/5</span>
<span class="token punctuation">[</span><span class="token function">HttpPut</span><span class="token punctuation">(</span><span class="token string">&quot;{id}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>IActionResult<span class="token punctuation">&gt;</span></span> <span class="token function">UpdateTodoItem</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">long</span></span> id<span class="token punctuation">,</span> <span class="token class-name">TodoItemDTO</span> todoItemDTO<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">!=</span> todoItemDTO<span class="token punctuation">.</span>Id<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">BadRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name"><span class="token keyword">var</span></span> todoItem <span class="token operator">=</span> <span class="token keyword">await</span> _context<span class="token punctuation">.</span>TodoItems<span class="token punctuation">.</span><span class="token function">FindAsync</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>todoItem <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  todoItem<span class="token punctuation">.</span>Name <span class="token operator">=</span> todoItemDTO<span class="token punctuation">.</span>Name<span class="token punctuation">;</span>
  todoItem<span class="token punctuation">.</span>IsCompleted <span class="token operator">=</span> todoItemDTO<span class="token punctuation">.</span>IsComplete<span class="token punctuation">;</span>

  <span class="token keyword">try</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">await</span> _context<span class="token punctuation">.</span><span class="token function">SaveChangesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DbUpdateConcurrencyException</span><span class="token punctuation">)</span> <span class="token keyword">when</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">TodoItemExists</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token function">NoContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// POST: api/TodoItems</span>
<span class="token punctuation">[</span>HttpPost<span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ActionResult<span class="token punctuation">&lt;</span>TodoItem<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">CreateTodoItem</span><span class="token punctuation">(</span><span class="token class-name">TodoItemDTO</span> todoItemDTO<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token class-name"><span class="token keyword">var</span></span> todoItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TodoItem</span>
  <span class="token punctuation">{</span>
    IsCompleted <span class="token operator">=</span> todoItemDTO<span class="token punctuation">.</span>IsComplete<span class="token punctuation">,</span>
    Name <span class="token operator">=</span> todoItemDTO<span class="token punctuation">.</span>Name
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  _context<span class="token punctuation">.</span>TodoItems<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>todoItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> _context<span class="token punctuation">.</span><span class="token function">SaveChangesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token function">CreatedAtAction</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>GetTodoItem<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> id <span class="token operator">=</span> todoItem<span class="token punctuation">.</span>Id <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function">ItemToDTO</span><span class="token punctuation">(</span>todoItem<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// DELETE: api/TodoItems/5</span>
<span class="token punctuation">[</span><span class="token function">HttpDelete</span><span class="token punctuation">(</span><span class="token string">&quot;{id}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>IActionResult<span class="token punctuation">&gt;</span></span> <span class="token function">DeleteTodoItem</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">long</span></span> id<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token class-name"><span class="token keyword">var</span></span> todoItem <span class="token operator">=</span> <span class="token keyword">await</span> _context<span class="token punctuation">.</span>TodoItems<span class="token punctuation">.</span><span class="token function">FindAsync</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>todoItem <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  _context<span class="token punctuation">.</span>TodoItems<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>todoItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> _context<span class="token punctuation">.</span><span class="token function">SaveChangesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token function">NoContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">TodoItemExist</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">long</span></span> id<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _context<span class="token punctuation">.</span>TodoItems<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Id <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name">TodoItemDTO</span> <span class="token function">ItemToDTO</span><span class="token punctuation">(</span><span class="token class-name">TodoItem</span> todoItem<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TodoItemDTO</span>
<span class="token punctuation">{</span>
  Id <span class="token operator">=</span> todoItem<span class="token punctuation">.</span>Id<span class="token punctuation">,</span>
  Name <span class="token operator">=</span> todoItem<span class="token punctuation">.</span>Name<span class="token punctuation">,</span>
  IsComplete <span class="token operator">=</span> todoItem<span class="token punctuation">.</span>IsCompleted
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token range operator">..</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br></div></div><ul><li>Postman 으로 확인해보면 DTO를 통해 데이터가 전달되는 것을 확인할 수 있습니다.
<img src="/assets/img/postman.test.13.157549db.png" alt="postman"></li></ul> <h3 id="general-domain-ssl-적용-shockz-io"><a href="#general-domain-ssl-적용-shockz-io" class="header-anchor">#</a> general domain ssl 적용 (shockz.io)</h3> <ul><li>상용 도메인을 구입하여 사용하고 있는 경우라면 해당 도메인에 대한 인증서를 구매하여 사용하고 있을 수 있습니다.</li> <li>제가 사용하는 <strong>shockz.io</strong> 도메인은 Let's Encrypt WildCard SSL 을 사용하고 있습니다. (<s>물론 무료 입니다.</s>) 갱신이 귀찮아  Synology NAS 에서 자동 갱신하고 있습니다.</li> <li><a href="../dev-log/synology">Synology NAS에서 인증서 적용</a></li> <li>Synology NAS의 기본 인증서 위치는 <code>/usr/syno/etc/certificate/_archive/DEFAULT</code> 파일에 기록되어 있습니다. Synology NAS에 ssh 로 연결하여 내용을 확인한 후 해당 디렉토리에서 <code>fullchain.pem</code>, <code>privkey.pem</code> 파일만 복사해서 사용하도록 합니다..</li> <li>상용 도메인 인증서를 가지고 있는 경우는 발급받는 사이트에서 안내해주는 방법으로 사용하시기 바랍니다.</li> <li><code>Nginx/Nginx.Dockerfile</code>, <code>Nginx/nginx.conf</code> 에서 ssl 관련부분을 수정합니다.</li></ul> <div class="language-docker line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> nginx:latest</span>

<span class="token instruction"><span class="token keyword">COPY</span> nginx.conf /etc/nginx/nginx.conf</span>
<span class="token instruction"><span class="token keyword">COPY</span> fullchain.pem /etc/ssl/certs/fullchain.pem</span>
<span class="token instruction"><span class="token keyword">COPY</span> privkey.pem /etc/ssl/private/privkey.pem</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># nginx.conf</span>
    ssl_certificate /etc/ssl/certs/fullchain.pem<span class="token punctuation">;</span>
    ssl_certificate_key /etc/ssl/private/privkey.pem<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="load-balancing-with-docker-compose"><a href="#load-balancing-with-docker-compose" class="header-anchor">#</a> load balancing with docker-compose</h3> <ul><li>현재까지는 <strong>api_1</strong> 으로만 테스트 하는 상황이었기 때문에 load balancing을 테스트할 수 없었습니다.</li> <li>load balancing을 테스트 하기 위해서는 좀 더 정교한 방법이 필요하나 현 단계에서는 구현의 단순함을 위해 docker-compose 상의 upstream 을 늘리는 방법을 택합니다.</li> <li>추후 Kubernetes 등을 통해 Auto-scaling 등을 구현할 예정입니다.</li> <li><code>docker-compose</code>, <code>nginx.conf</code> 를 수정하여 api_1 과 같이 api_2, api_3을 추가합니다.</li></ul> <div class="language-docker line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-docker"><code>  nginx:
    depends_on:
      - sql
      - api_1
      - api_2
      - api_3
    build:
      context: ./Nginx
      dockerfile: Nginx.Dockerfile
    ports:
      - &quot;4000:80&quot;
      - &quot;4001:443&quot;
    restart: &quot;no&quot;

  ...

  api_2:
    depends_on:
      - sql
    build:
      context: ./todoCore3.Api
      dockerfile: Api.Dockerfile
    expose:
      - &quot;5000&quot;
    restart: &quot;no&quot;

  api_3:
    depends_on:
      - sql
    build:
      context: ./todoCore3.Api
      dockerfile: Api.Dockerfile
    expose:
      - &quot;5000&quot;
    restart: &quot;no&quot;
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><ul><li><code>nginx.conf</code>에 upstream 부분에 api_2, api_3을 추가합니다.</li></ul> <div class="language-bash line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-bash"><code>  upstream web-api <span class="token punctuation">{</span>
    server api_1:5000<span class="token punctuation">;</span>
    server api_2:5000<span class="token punctuation">;</span>
    server api_3:5000<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><code>$ docker-compose up --build -d</code>로 확인합니다.
<img src="/assets/img/docker-compose.1.9eabd25b.png" alt="docker-compose"> <img src="/assets/img/docker-compose.2.b3d31690.png" alt="docker-compose"> <img src="/assets/img/postman.test.14.be6321a1.png" alt="postman"></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>docker 컨테이너들이 자동 시작되도록 하기 위해서는 다음의 옵션 중에 하나를 선택할 수 있습니다.</p> <blockquote><p>docker-compose restart 옵션</p></blockquote> <ul><li>no: 수동으로 재시작합니다.</li> <li>always: 수동으로 끄기 전까지는 항상 재시작됩니다.</li> <li>on-failure: 오류가 있을 시에 재시작합니다.</li></ul> <div class="language-docker line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br></div><pre class="language-docker"><code>  api_3:
    ...
    restart: &quot;always&quot;
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <h3 id="logging"><a href="#logging" class="header-anchor">#</a> logging</h3> <p>이 시점에서 api 내부의 logging 을 추가하는 것이 좋습니다. 추후 프로덕션 환경을 위해서라도 logging 은 초반부터 정리하고 가는 것이 좋기 때문입니다.<br>
logging 은 .net core 의 기본 로거도 있고 전통적으로 사용되는 여러가지 외부 라이브러리들 (NLog, log4net 등)이 있으나, 여기서는 다음의 로거를 사용할 예정입니다.</p> <ul><li><a href="https://serilog.net/" target="_blank" rel="noopener noreferrer">Serilog<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://datalust.co/seq" target="_blank" rel="noopener noreferrer">Seq<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p><strong>Serilog</strong> 는 api 내부의 세부적인 로깅을 위해서 사용하며 <strong>Seq</strong> 는 로그 검색 및 비주얼화를 위해 사용됩니다.</p> <ul><li><strong>Seq</strong> Logger는 컨테이너로 띄우고 <code>http://localhost:5340</code> 으로 접속하여 확인할 수 있습니다.</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> volume create seq_data <span class="token comment"># 로깅 데이터 저장을 위한 볼륨 생성</span>
$ <span class="token function">docker</span> run <span class="token parameter variable">--name</span> <span class="token function">seq</span> <span class="token parameter variable">-d</span> <span class="token parameter variable">--restart</span> unless-stopped <span class="token parameter variable">-e</span> <span class="token assign-left variable">ACCEPT_EULA</span><span class="token operator">=</span>Y <span class="token parameter variable">-v</span> seq_data:/data <span class="token parameter variable">--network</span><span class="token operator">=</span>todo-core <span class="token parameter variable">-p</span> <span class="token number">5340</span>:80 <span class="token parameter variable">-p</span> <span class="token number">5341</span>:5341 datalust/seq:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Todo api 와는 별개의 container 로 동작되므로 컨테이너 간 네트워크 연결을 위해 Todo api와 같은 네트워크로 설정합니다.(<strong>--network=todo-core</strong>)</p></div> <ul><li><p><strong>Serilog</strong> 적용시에는 몇 가지 고려사항이 있습니다.</p> <ul><li>보통 logger 에 대한 세부적인 설정들을 appsettings.json 과 같은 파일에 기록하여 사용하게 되는데, app 이 실행되면서 Configuration을 읽어오는 과정을 거쳐야 하기 때문에 최대한 초기에 configuration 을 로드 해야 합니다.</li> <li>.net core 에서는 일반적으로 <code>Startup()</code> 이 실행되는 시점에서는 Configuration 로딩이 마무리가 되지만 <code>Startup()</code> 에서 Logger를 세팅할 경우 app 진입 시점의 로깅이 빠지는 상황이 발생할 수 있습니다.</li> <li>또한, configuration 파일의 스키마 혹은 단순 JSON syntax 오류, configuration 파일 단순 누락, JSON syntax 오류, 어셈블리 로딩 이슈 등의 문제가 발생할때 logging 이 되지 않는 상황이 발생할 수 있습니다.</li> <li>Logger는 가능하면 로깅하고자 하는 대상보다 먼저 세팅이 되어야 하며 종속성으로부터 최대한 자유로워야 합니다.</li> <li>Serilog 의 sample 을 비교하는 것도 도움이 될것입니다.
<ul><li><a href="https://github.com/serilog/serilog-aspnetcore/blob/71165692d5f66c811c3b251047b12c259ac2fe23/samples/InlineInitializationSample/Program.cs#L20" target="_blank" rel="noopener noreferrer">Inline initialization<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/serilog/serilog-aspnetcore/blob/71165692d5f66c811c3b251047b12c259ac2fe23/samples/EarlyInitializationSample/Program.cs#L12" target="_blank" rel="noopener noreferrer">Early initailization<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li>위의 방법 말고도 한가지 대안이 더 있습니다.</li> <li>현재 app 이 container 상에서 구동이 되기 때문에 container가 올라가는 시점에서 환경변수로 Logger configuration 을 지정하여 Logger를 초기화 하는 방법이 있습니다.<div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br></div><pre class="language-csharp"><code><span class="token punctuation">.</span>WriteTo<span class="token punctuation">.</span><span class="token function">Seq</span><span class="token punctuation">(</span>
  Environment<span class="token punctuation">.</span><span class="token function">GetEnvironmentVariable</span><span class="token punctuation">(</span><span class="token string">&quot;SEQ_URL&quot;</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">&quot;http://localhost:5341&quot;</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li>하지만 여기서는 구현의 단순함을 위하여 <code>appSettings.json</code> 을 사용하겠습니다.</li> <li><a href="https://github.com/shockzinfinity/simple-serilog-seq" target="_blank" rel="noopener noreferrer">간단한 serilog 예제<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><p><strong>Serilog</strong> 관련 패키지를 추가합니다.</p></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ dotnet <span class="token function">add</span> package Serilog.AspNetCore
$ dotnet <span class="token function">add</span> package Serilog.Seq
$ dotnet <span class="token function">add</span> package Serilog.Sinks.Seq
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>Program.cs</code> 을 수정합니다.</li></ul> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IConfiguration</span> Configuration <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConfigurationBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">SetBasePath</span><span class="token punctuation">(</span>Directory<span class="token punctuation">.</span><span class="token function">GetCurrentDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddJsonFile</span><span class="token punctuation">(</span><span class="token string">&quot;appsettings.json&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">optional</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">reloadOnChange</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddJsonFile</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;appsettings.</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span><span class="token function">GetEnvironmentVariable</span><span class="token punctuation">(</span><span class="token string">&quot;ASPNETCORE_ENVIRONMENT&quot;</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">&quot;Production&quot;</span></span><span class="token punctuation">}</span></span><span class="token string">.json&quot;</span></span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">optional</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddEnvironmentVariables</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    Log<span class="token punctuation">.</span>Logger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LoggerConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>MinimumLevel<span class="token punctuation">.</span><span class="token function">Override</span><span class="token punctuation">(</span><span class="token string">&quot;Microsoft.AspNetCore&quot;</span><span class="token punctuation">,</span> LogEventLevel<span class="token punctuation">.</span>Warning<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>Enrich<span class="token punctuation">.</span><span class="token function">FromLogContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>WriteTo<span class="token punctuation">.</span><span class="token function">Console</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>WriteTo<span class="token punctuation">.</span><span class="token function">File</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RenderedCompactJsonFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">&quot;./logs/log.json&quot;</span><span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">rollingInterval</span><span class="token punctuation">:</span> RollingInterval<span class="token punctuation">.</span>Day<span class="token punctuation">,</span>
        <span class="token named-parameter punctuation">rollOnFileSizeLimit</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// maximum 1GB, could be null</span>
        retainedFileCountLimit<span class="token punctuation">:</span> <span class="token number">31</span><span class="token punctuation">)</span> <span class="token comment">// number of files, could be null</span>
      <span class="token punctuation">.</span>WriteTo<span class="token punctuation">.</span><span class="token function">Seq</span><span class="token punctuation">(</span>Configuration<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;SEQ_URL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">CreateLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
      Log<span class="token punctuation">.</span><span class="token function">Information</span><span class="token punctuation">(</span><span class="token string">&quot;Starting up...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">CreateHostBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>ex<span class="token punctuation">,</span> <span class="token string">&quot;Application start-up failed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span>
    <span class="token punctuation">{</span>
      Log<span class="token punctuation">.</span><span class="token function">CloseAndFlush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IHostBuilder</span> <span class="token function">CreateHostBuilder</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    Host<span class="token punctuation">.</span><span class="token function">CreateDefaultBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">UseSerilog</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ConfigureWebHostDefaults</span><span class="token punctuation">(</span>webBuilder <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
          webBuilder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">UseStartup</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Startup<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><ul><li><code>appsettings.json</code> 에 .net core logger 설정은 제거합니다. (appsettings.Development.json 은 선택사항)</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;Logging&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;LogLevel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;Default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Information&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;Microsoft&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Warning&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;Microsoft.Hosting.Lifetime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Information&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><code>appsettings.json</code>에 <strong>SEQ_URL</strong> 추가</li></ul> <div class="language-json line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;AllowedHosts&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;SEQ_URL&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://seq:5341&quot;</span> <span class="token comment">// seq 는 container 이름입니다.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>Request logging 을 위해 <code>Startup.cs</code> 에 logging 추가</li></ul> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IWebHostEnvironment</span> env<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
  app<span class="token punctuation">.</span><span class="token function">UseSerilogRequestLogging</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>현재 Seq Logger 는 docker-compose 외부의 컨테이너로 띄운 상태이므로 컨테이너 간 통신을 위하여 네트워크 조인이 필요하므로 <code>docker-compose.yml</code>에 network 부분 추가하여 연결합니다.</li></ul> <div class="language-docker line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-docker"><code>...
networks:
  default:
    external:
      name: &quot;todo-core&quot;
...
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><code>docker-compose up --build -d</code> 로 컨테이너를 작동시킨 후 <strong>seq logger (http://localhost:5340)</strong> 로 접속하여 확인합니다
<img src="/assets/img/seq.result.1.fc2fa8a8.png" alt="seq"></li></ul> <h3 id="swagger-openapi"><a href="#swagger-openapi" class="header-anchor">#</a> Swagger (OpenAPI)</h3> <p>API 를 개발할때 중요한 요소 중 하나가 <strong>문서화</strong> 입니다. 개발자 혹은 기계들에게 접근성과 가독성을 제공하는 것이 중요하기 때문입니다. 특히 개발자에게 문서화는 중요한 도전과제이기도 합니다.(<s>문서화가 제일 힘든듯...</s>) API spec, Help page, Guide 등은 다른 개발자와 소통할 수 있는 중요한 주제이기 때문에 이번 섹션에서는 문서화를 다룹니다. 추후 API 변경이 있을때마다 스펙문서를 조정해야 하기 때문에 코드와 결합이 되어 있는 것이 좋습니다. 문서의 디자인의 변경이 필요한 경우를 제외하고는 대부분 자동생성이 가능하기 때문에 <strong>디자이느님</strong>의 가르침이 있기 전까지는 해당 문서는 자동 생성하는 방법을 택하는 것이 좋습니다.</p> <p>OpenAPI Specification 으로도 알려져 있는 <a href="https://swagger.io/" target="_blank" rel="noopener noreferrer">Swagger<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>의 .NET 구현체인 <a href="https://github.com/domaindrivendev/Swashbuckle.AspNetCore" target="_blank" rel="noopener noreferrer">Swashbuckle.AspNetCore<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 를 적용하도록 하겠습니다.</p> <ul><li>프로젝트에 Swashbuckle.AspNetCore 를 추가합니다.</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ dotnet <span class="token function">add</span> package Swashbuckle.AspNetCore
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>Startup.cs</code> 에 Swagger Middleware 를 추가합니다.</li></ul> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContext</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TodoContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>opt <span class="token operator">=&gt;</span> opt<span class="token punctuation">.</span><span class="token function">UseSqlServer</span><span class="token punctuation">(</span><span class="token string">&quot;Data Source=sql;Database=todos;Integrated Security=false;User ID=sa;Password=********&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  services<span class="token punctuation">.</span><span class="token function">AddControllers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  services<span class="token punctuation">.</span><span class="token function">AddSwaggerGen</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span>
  <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span><span class="token function">SwaggerDoc</span><span class="token punctuation">(</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenApiInfo</span> <span class="token punctuation">{</span> Title <span class="token operator">=</span> <span class="token string">&quot;Todo API&quot;</span><span class="token punctuation">,</span> Version <span class="token operator">=</span> <span class="token string">&quot;v1&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li><strong>Startup/Configure()</strong> 메서드에서 Swagger UI 를 활성화 시킵니다.</li></ul> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IWebHostEnvironment</span> env<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
  app<span class="token punctuation">.</span><span class="token function">UseStaticFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Swagger UI 가 Static files를 사용하므로 추가</span>

  app<span class="token punctuation">.</span><span class="token function">UseSwagger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// JSON endpoint 로 생성된 Swagger 활성화</span>
  app<span class="token punctuation">.</span><span class="token function">UseSwaggerUI</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span>
  <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span><span class="token function">SwaggerEndpoint</span><span class="token punctuation">(</span><span class="token string">&quot;/swagger/v1/swagger.json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Todo API v1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    c<span class="token punctuation">.</span>RoutePrefix <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span> <span class="token comment">// https://localhost:4001/ 로 접속했을때 나오게 하기 위해...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>4번 라인의 경우 swagger는 기본적으로 런타임에서 생성되는 json 기반으로 동작되기 때문에 정적파일에 대한 경로가 필요하므로 추가합니다.<br> <a href="https://docs.microsoft.com/ko-kr/aspnet/core/fundamentals/static-files?view=aspnetcore-3.1" target="_blank" rel="noopener noreferrer">ASP.NET Core의 정적 파일<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>6번 ~ 11번 라인은 swagger 를 사용하기 위한 미들웨어 추가와 엔드포인트를 위한 라인입니다. <code>https://localhost:4001</code>로 접속하면 swagger api spec 이 나옵니다.
<blockquote><p>route prefix 를 기본값으로 사용할때 swagger ui 는 <code>https://localhost:4001/swagger/</code> 입니다.</p></blockquote></li></ul> <p>위의 코드로 기본적인 API 스펙문서가 생성되지만 좀 더 풍부한 스펙 문서화를 위해 몇가지 더 추가하도록 하겠습니다.</p> <ul><li><code>Startup/ConfigureServices()</code> 에서 SwaggerDoc 부분을 보강합니다.</li></ul> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>services<span class="token punctuation">.</span><span class="token function">AddSwaggerGen</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
  c<span class="token punctuation">.</span><span class="token function">SwaggerDoc</span><span class="token punctuation">(</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenApiInfo</span>
  <span class="token punctuation">{</span>
    Version <span class="token operator">=</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span>
    Title <span class="token operator">=</span> <span class="token string">&quot;ToDo API&quot;</span><span class="token punctuation">,</span>
    Description <span class="token operator">=</span> <span class="token string">&quot;Todo App 을 만드는 꽤 복잡한 방법에 대한 ASP.NET Core WebAPI&quot;</span><span class="token punctuation">,</span>
    TermsOfService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://todo.shockz.io/terms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Contact <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenApiContact</span>
    <span class="token punctuation">{</span>
      Name <span class="token operator">=</span> <span class="token string">&quot;shockz&quot;</span><span class="token punctuation">,</span>
      Email <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">,</span> <span class="token comment">// 스팸은 먹는겁니다.</span>
      Url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span><span class="token string">&quot;https://twitter.com/somebody&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 트위터를 안써봐서...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    License <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenApiLicense</span>
    <span class="token punctuation">{</span>
      Name <span class="token operator">=</span> <span class="token string">&quot;MIT&quot;</span><span class="token punctuation">,</span>
      Url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span><span class="token string">&quot;https://github.com/shockzinfinity/todo-app-complicated/blob/2c4c937fa9ecfca72e37ba4e79581e2eabe4e9b8/LICENSE#L1&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><img src="/assets/img/swagger.2.2f3720ac.png" alt="swagger"></p> <ul><li>각 엔드포인트의 XML 주석을 표현하기 위해서 다음과 같이 작업합니다.
<ol><li>프로젝트 빌드시에 XML generate 되도록 합니다.</li> <li>각 컨트롤러의 메서드에서 XML 주석을 통하여 내용을 보강합니다.</li></ol></li></ul> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token operator">&lt;</span>PropertyGroup<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>GenerateDocumentationFile<span class="token operator">&gt;</span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span>GenerateDocumentationFile<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>NoWarn<span class="token operator">&gt;</span>$<span class="token punctuation">(</span>NoWarn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">1591</span><span class="token operator">&lt;</span><span class="token operator">/</span>NoWarn<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>PropertyGroup<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><ul><li>public type 과 members 가 주석이 없으면 <strong>warning code: 1591</strong> 을 발생시키게 되는데, <strong><NoWarn>$(NoWarn);1591</NoWarn></strong> 이 해당 warning 을 없애줍니다.</li> <li>코드 내부에서 warning 을 제거하기 위해서는 <strong>#pragma warning</strong> 프리프로세서를 사용합니다. 예를 들어 Program 클래스 전체에 대한 warning 메시지 제거를 위해서는 다음과 같이 사용합니다.</li></ul></blockquote> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-csharp"><code><span class="token keyword">namespace</span> <span class="token namespace">todoCore3<span class="token punctuation">.</span>Api</span>
<span class="token punctuation">{</span>
<span class="token preprocessor property">#<span class="token directive keyword">pragma</span> warning disable CS1591</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
  <span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IHostBuilder</span> <span class="token function">CreateHostBuilder</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token preprocessor property">#<span class="token directive keyword">pragma</span> warning restore CS1591</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>swagger 가 생성된 XML 주석 파일을 사용하게 위해서는 다음과 같이 코드를 <code>AddSwaggerGen()</code> 메서드 내부에 추가합니다.</li></ul> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
  services<span class="token punctuation">.</span><span class="token function">AddSwaggerGen</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span>
  <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span><span class="token function">SwaggerDoc</span><span class="token punctuation">(</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenApiInfo</span>
    <span class="token punctuation">{</span>
      Version <span class="token operator">=</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span>
      Title <span class="token operator">=</span> <span class="token string">&quot;ToDo API&quot;</span><span class="token punctuation">,</span>
      Description <span class="token operator">=</span> <span class="token string">&quot;Todo App 을 만드는 꽤 복잡한 방법에 대한 ASP.NET Core WebAPI&quot;</span><span class="token punctuation">,</span>
      TermsOfService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://todo.shockz.io/terms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      Contact <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenApiContact</span>
      <span class="token punctuation">{</span>
        Name <span class="token operator">=</span> <span class="token string">&quot;shockz&quot;</span><span class="token punctuation">,</span>
        Email <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">,</span> <span class="token comment">// 스팸은 먹는겁니다.</span>
        Url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span><span class="token string">&quot;https://twitter.com/somebody&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 트위터를 안써봐서...</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      License <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenApiLicense</span>
      <span class="token punctuation">{</span>
        Name <span class="token operator">=</span> <span class="token string">&quot;MIT&quot;</span><span class="token punctuation">,</span>
        Url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span><span class="token string">&quot;https://github.com/shockzinfinity/todo-app-complicated/blob/2c4c937fa9ecfca72e37ba4e79581e2eabe4e9b8/LICENSE#L1&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> xmlFile <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Assembly<span class="token punctuation">.</span><span class="token function">GetExecutingAssembly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Name</span><span class="token punctuation">}</span></span><span class="token string">.xml&quot;</span></span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> xmlPath <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>AppContext<span class="token punctuation">.</span>BaseDirectory<span class="token punctuation">,</span> xmlFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    c<span class="token punctuation">.</span><span class="token function">IncludeXmlComments</span><span class="token punctuation">(</span>xmlPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><ul><li>각 endpoint 에 대한 주석은 <code>///</code> XML 주석으로 입력합니다. XML 주석을 입력하게 되면 컴파일 단계에서 해당 주석이 XML 파일로 떨궈지고, Swagger 가 해당 XML 파일을 읽어들여 Swagger UI 에 적용하게 됩니다.</li></ul> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-csharp"><code><span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// Todo item 을 생성합니다.</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token comment">/// &lt;remarks&gt;</span>
<span class="token comment">/// Sample request:</span>
<span class="token comment">///</span>
<span class="token comment">///		POST api/TodoItems</span>
<span class="token comment">///		{</span>
<span class="token comment">///			&quot;name&quot;: &quot;Item no 1&quot;,</span>
<span class="token comment">///			&quot;isCompleted&quot;: false</span>
<span class="token comment">///		}</span>
<span class="token comment">///</span>
<span class="token comment">/// &lt;/remarks&gt;</span>
<span class="token comment">/// &lt;param name=&quot;todoItemDTO&quot;&gt;&lt;/param&gt;</span>
<span class="token comment">/// &lt;returns&gt;생성된 Todo item&lt;/returns&gt;</span>
<span class="token comment">/// &lt;response code=&quot;201&quot;&gt;생성된 Todo item&lt;/response&gt;</span>
<span class="token comment">/// &lt;response code=&quot;400&quot;&gt;todo item 이 null 일 경우&lt;/response&gt;</span>
<span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
<span class="token comment">// POST: api/TodoItems</span>
<span class="token punctuation">[</span>HttpPost<span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ActionResult<span class="token punctuation">&lt;</span>TodoItem<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">CreateTodoItem</span><span class="token punctuation">(</span><span class="token class-name">TodoItemDTO</span> todoItemDTO<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><img src="/assets/img/swagger.3.26689cee.png" alt="swagger"> <img src="/assets/img/swagger.4.0297987f.png" alt="swagger"></p> <ul><li>data annotations 으로 모델에도 적용이 가능합니다.</li></ul> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TodoItem</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">long</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DefaultValue</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsCompleted <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Timestamp</span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> RowVersion <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TodoItemDTO</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">long</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DefaultValue</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsComplete <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><img src="/assets/img/swagger.5.b7a07387.png" alt="swagger"></p> <ul><li>Http Status Code 에 따른 주석 추가도 가능합니다.</li></ul> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ProducesResponseType</span><span class="token attribute-arguments"><span class="token punctuation">(</span>StatusCodes<span class="token punctuation">.</span>Status201Created<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ProducesResponseType</span><span class="token attribute-arguments"><span class="token punctuation">(</span>StatusCodes<span class="token punctuation">.</span>Status400BadRequest<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ActionResult<span class="token punctuation">&lt;</span>TodoItem<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">CreateTodoItem</span><span class="token punctuation">(</span><span class="token class-name">TodoItemDTO</span> todoItemDTO<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="authentication"><a href="#authentication" class="header-anchor">#</a> Authentication</h3> <p>인증은 실제 서비스를 운영하는 데에 있어서 상당히 중요한 부분입니다. 추후 별도의 포스트를 통해 더 자세하게 다뤄보기로 하고 이 Tutorial 에서는 서비스에 필요한 최소한을 구현하는 것을 목표로 하겠습니다.</p> <p>인증은</p> <ol><li>서비스 자체에서 구현하는 방법</li> <li>외부 인증 서비스를 이용하는 방법<br>
으로 생각해볼 수 있을것 같습니다. 외부 인증서비스를 이용하는 것이 속 편하지만 이 Tutorial 에서는 간단하게 JWT 토큰을 이용하는 인증을 구현해보겠습니다.</li></ol> <ul><li>먼저 User 모델 및 관련 DTO 들을 먼저 만들겠습니다.</li></ul> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// Models/User.cs 추가</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FirstName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> LastName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Username <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> PasswordHash <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> PasswordSalt <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Models/UserAuthenticateDTO.cs 추가 - Frontend 의 로그인을 위한 DTO</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserAuthenticateDTO</span>
<span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Username <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Password <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Models/UserDTO.cs - 유저 정보를 위한 DTO</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDTO</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FirstName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> LastName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Username <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Models/UserRegisterDTO.cs - 유저 등록을 위한 DTO</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserRegisterDTO</span>
<span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FirstName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> LastName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Username <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Password <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Models/UserUpdateDTO.cs - 유저 정보 수정을 위한 DTO (이름, 패스워드 등과 같은...)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserUpdateDTO</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FirstName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> LastName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Username <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Password <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><ul><li>객체 복사의 편의를 위해 <a href="https://automapper.org/" target="_blank" rel="noopener noreferrer">AutoMapper<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 패키지를 추가하고, mapping 을 추가합니다. <strong>AutoMapper</strong> 는 Tutorial 전반에 걸쳐서 사용할 예정입니다.</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ dotnet <span class="token function">add</span> package Automapper
$ dotnet <span class="token function">add</span> package Automapper.Extensions.Microsoft.DependencyInjection
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserProfile</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Profile</span></span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token function">UserProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token generic-method"><span class="token function">CreateMap</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>User<span class="token punctuation">,</span> UserDTO<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token generic-method"><span class="token function">CreateMap</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UserRegisterDTO<span class="token punctuation">,</span> User<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token generic-method"><span class="token function">CreateMap</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UserUpdateDTO<span class="token punctuation">,</span> User<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>User 와 관련된 로직을 수행할 <code>UserService</code>를 생성하고, DI (Dependency Injection) 를 위해 interface 를 추가하겠습니다.</li></ul> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IUserService</span>
<span class="token punctuation">{</span>
  <span class="token return-type class-name">User</span> <span class="token function">Authenticate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> username<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> <span class="token function">GetAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token return-type class-name">User</span> <span class="token function">GetBy</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token return-type class-name">User</span> <span class="token function">Create</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> password <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Delete</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IUserService</span></span>
<span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">TodoContext</span> _context<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token function">UserService</span><span class="token punctuation">(</span><span class="token class-name">TodoContext</span> context<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _context <span class="token operator">=</span> context <span class="token operator">??</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token return-type class-name">User</span> <span class="token function">Authenticate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> username<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> password<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> _context<span class="token punctuation">.</span>Users<span class="token punctuation">.</span><span class="token function">SingleOrDefault</span><span class="token punctuation">(</span>u <span class="token operator">=&gt;</span> u<span class="token punctuation">.</span>Username <span class="token operator">==</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">VerifyPasswordHash</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> user<span class="token punctuation">.</span>PasswordHash<span class="token punctuation">,</span> user<span class="token punctuation">.</span>PasswordSalt<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token return-type class-name">User</span> <span class="token function">Create</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> password<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AppException</span><span class="token punctuation">(</span><span class="token string">&quot;Password is required.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>_context<span class="token punctuation">.</span>Users<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span>u <span class="token operator">=&gt;</span> u<span class="token punctuation">.</span>Username <span class="token operator">==</span> user<span class="token punctuation">.</span>Username<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AppException</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Username: '$</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">user<span class="token punctuation">.</span>Username</span><span class="token punctuation">}</span></span><span class="token string">' is taken.&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> passwordHash<span class="token punctuation">,</span> passwordSalt<span class="token punctuation">;</span>
    <span class="token function">CreatePasswordHash</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> <span class="token keyword">out</span> passwordHash<span class="token punctuation">,</span> <span class="token keyword">out</span> passwordSalt<span class="token punctuation">)</span><span class="token punctuation">;</span>

    user<span class="token punctuation">.</span>PasswordHash <span class="token operator">=</span> passwordHash<span class="token punctuation">;</span>
    user<span class="token punctuation">.</span>PasswordSalt <span class="token operator">=</span> passwordSalt<span class="token punctuation">;</span>

    _context<span class="token punctuation">.</span>Users<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _context<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Delete</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> _context<span class="token punctuation">.</span>Users<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      _context<span class="token punctuation">.</span>Users<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
      _context<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> <span class="token function">GetAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">return</span> _context<span class="token punctuation">.</span>Users<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token return-type class-name">User</span> <span class="token function">GetBy</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">return</span> _context<span class="token punctuation">.</span>Users<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> password <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> updateUser <span class="token operator">=</span> _context<span class="token punctuation">.</span>Users<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>updateUser <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AppException</span><span class="token punctuation">(</span><span class="token string">&quot;User not found.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>Username<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>Username <span class="token operator">!=</span> user<span class="token punctuation">.</span>Username<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_context<span class="token punctuation">.</span>Users<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span>u <span class="token operator">=&gt;</span> u<span class="token punctuation">.</span>Username <span class="token operator">==</span> user<span class="token punctuation">.</span>Username<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AppException</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Username: '$</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">user<span class="token punctuation">.</span>Username</span><span class="token punctuation">}</span></span><span class="token string">'is taken.&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      updateUser<span class="token punctuation">.</span>Username <span class="token operator">=</span> user<span class="token punctuation">.</span>Username<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>FirstName<span class="token punctuation">)</span><span class="token punctuation">)</span>
      updateUser<span class="token punctuation">.</span>FirstName <span class="token operator">=</span> user<span class="token punctuation">.</span>FirstName<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>LastName<span class="token punctuation">)</span><span class="token punctuation">)</span>
      updateUser<span class="token punctuation">.</span>LastName <span class="token operator">=</span> user<span class="token punctuation">.</span>LastName<span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> passwordHash<span class="token punctuation">,</span> passwordSalt<span class="token punctuation">;</span>
      <span class="token function">CreatePasswordHash</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> <span class="token keyword">out</span> passwordHash<span class="token punctuation">,</span> <span class="token keyword">out</span> passwordSalt<span class="token punctuation">)</span><span class="token punctuation">;</span>

      user<span class="token punctuation">.</span>PasswordHash <span class="token operator">=</span> passwordHash<span class="token punctuation">;</span>
      user<span class="token punctuation">.</span>PasswordSalt <span class="token operator">=</span> passwordSalt<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    _context<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span>updateUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _context<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CreatePasswordHash</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> password<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> passwordHash<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> passwordSalt<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>password <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Value could not be empty or whitespace.&quot;</span><span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> hmac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>Security<span class="token punctuation">.</span>Cryptography<span class="token punctuation">.</span>HMACSHA512</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      passwordSalt <span class="token operator">=</span> hmac<span class="token punctuation">.</span>Key<span class="token punctuation">;</span>
      passwordHash <span class="token operator">=</span> hmac<span class="token punctuation">.</span><span class="token function">ComputeHash</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>Text<span class="token punctuation">.</span>Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">VerifyPasswordHash</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> password<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> storedHash<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> storedSalt<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>password <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Value could not be empty or whitespace.&quot;</span><span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>storedHash<span class="token punctuation">.</span>Length <span class="token operator">!=</span> <span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid stored hash.&quot;</span><span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>storedHash<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>storedSalt<span class="token punctuation">.</span>Length <span class="token operator">!=</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid stored salt.&quot;</span><span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>storedSalt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> hmac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>Security<span class="token punctuation">.</span>Cryptography<span class="token punctuation">.</span>HMACSHA512</span><span class="token punctuation">(</span>storedSalt<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">var</span></span> computedHash <span class="token operator">=</span> hmac<span class="token punctuation">.</span><span class="token function">ComputeHash</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>Text<span class="token punctuation">.</span>Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> computedHash<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>computedHash<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> storedHash<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br></div></div><ul><li><code>UsersController</code> 을 통해 endpoint 를 생성합니다.</li> <li>JWT 토큰을 사용할 것이므로 관련 패키지도 설치합니다.</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ dotnet <span class="token function">add</span> package Microsoft.AspNetCore.Authentication.JwtBearer
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Authorize</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;api/[controller]&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiController</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UsersController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ControllerBase</span></span>
<span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">IUserService</span> _userService<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">IMapper</span> _mapper<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">AppSettings</span> _appSettings<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token function">UsersController</span><span class="token punctuation">(</span><span class="token class-name">IUserService</span> userService<span class="token punctuation">,</span> <span class="token class-name">IMapper</span> mapper<span class="token punctuation">,</span> <span class="token class-name">IOptions<span class="token punctuation">&lt;</span>AppSettings<span class="token punctuation">&gt;</span></span> appSettings<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _userService <span class="token operator">=</span> userService <span class="token operator">??</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>userService<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _mapper <span class="token operator">=</span> mapper <span class="token operator">??</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>mapper<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _appSettings <span class="token operator">=</span> appSettings<span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AllowAnonymous</span></span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;authenticate&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Authenticate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span><span class="token class-name">UserAuthenticateDTO</span> model<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> _userService<span class="token punctuation">.</span><span class="token function">Authenticate</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>Username<span class="token punctuation">,</span> model<span class="token punctuation">.</span>Password<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token function">BadRequest</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{</span> message <span class="token operator">=</span> <span class="token string">&quot;Username or Password is incorrect&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> tokenHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtSecurityTokenHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> key <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>ASCII<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>_appSettings<span class="token punctuation">.</span>Secret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> tokenDescriptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SecurityTokenDescriptor</span>
    <span class="token punctuation">{</span>
      Subject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ClaimsIdentity</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Claim<span class="token punctuation">[</span><span class="token punctuation">]</span></span>
      <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Claim</span><span class="token punctuation">(</span>ClaimTypes<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> user<span class="token punctuation">.</span>Id<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      Expires <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>UtcNow<span class="token punctuation">.</span><span class="token function">AddDays</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      SigningCredentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SigningCredentials</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SymmetricSecurityKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> SecurityAlgorithms<span class="token punctuation">.</span>HmacSha256Signature<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> token <span class="token operator">=</span> tokenHandler<span class="token punctuation">.</span><span class="token function">CreateToken</span><span class="token punctuation">(</span>tokenDescriptor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> tokenString <span class="token operator">=</span> tokenHandler<span class="token punctuation">.</span><span class="token function">WriteToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token keyword">new</span>
    <span class="token punctuation">{</span>
      Id <span class="token operator">=</span> user<span class="token punctuation">.</span>Id<span class="token punctuation">,</span>
      Username <span class="token operator">=</span> user<span class="token punctuation">.</span>Username<span class="token punctuation">,</span>
      FirstName <span class="token operator">=</span> user<span class="token punctuation">.</span>FirstName<span class="token punctuation">,</span>
      LastName <span class="token operator">=</span> user<span class="token punctuation">.</span>LastName<span class="token punctuation">,</span>
      Token <span class="token operator">=</span> tokenString
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AllowAnonymous</span></span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;register&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span> <span class="token class-name">UserRegisterDTO</span> model<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> _mapper<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Map</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
      _userService<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> model<span class="token punctuation">.</span>Password<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AppException</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">BadRequest</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{</span> message <span class="token operator">=</span> ex<span class="token punctuation">.</span>Message <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">GetAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> users <span class="token operator">=</span> _userService<span class="token punctuation">.</span><span class="token function">GetAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> model <span class="token operator">=</span> _mapper<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Map</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IList<span class="token punctuation">&lt;</span>UserDTO<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;{id}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">GetBy</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> _userService<span class="token punctuation">.</span><span class="token function">GetBy</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> model <span class="token operator">=</span> _mapper<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Map</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UserDTO<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPut</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;{id}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span><span class="token class-name">UserUpdateDTO</span> model<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> _mapper<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Map</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span>Id <span class="token operator">=</span> id<span class="token punctuation">;</span>

    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
      _userService<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> model<span class="token punctuation">.</span>Password<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AppException</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">BadRequest</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{</span> message <span class="token operator">=</span> ex<span class="token punctuation">.</span>Message <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpDelete</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;{id}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Delete</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _userService<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br></div></div><ul><li>최종적으로 <code>Startup.cs</code> 에서 관련 인스턴스들을 injection 합니다.</li></ul> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><br><br></div><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
  services<span class="token punctuation">.</span><span class="token function">AddCors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  services<span class="token punctuation">.</span><span class="token function">AddControllers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  services<span class="token punctuation">.</span><span class="token function">AddAutoMapper</span><span class="token punctuation">(</span>AppDomain<span class="token punctuation">.</span>CurrentDomain<span class="token punctuation">.</span><span class="token function">GetAssemblies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name"><span class="token keyword">var</span></span> appSettingsSection <span class="token operator">=</span> Configuration<span class="token punctuation">.</span><span class="token function">GetSection</span><span class="token punctuation">(</span><span class="token string">&quot;AppSettings&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Configure</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>AppSettings<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>appSettingsSection<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name"><span class="token keyword">var</span></span> appSettings <span class="token operator">=</span> appSettingsSection<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>AppSettings<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name"><span class="token keyword">var</span></span> key <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>ASCII<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>appSettings<span class="token punctuation">.</span>Secret<span class="token punctuation">)</span><span class="token punctuation">;</span>
  services<span class="token punctuation">.</span><span class="token function">AddAuthentication</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span>
  <span class="token punctuation">{</span>
    s<span class="token punctuation">.</span>DefaultAuthenticateScheme <span class="token operator">=</span> JwtBearerDefaults<span class="token punctuation">.</span>AuthenticationScheme<span class="token punctuation">;</span>
    s<span class="token punctuation">.</span>DefaultChallengeScheme <span class="token operator">=</span> JwtBearerDefaults<span class="token punctuation">.</span>AuthenticationScheme<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">AddJwtBearer</span><span class="token punctuation">(</span>j <span class="token operator">=&gt;</span>
  <span class="token punctuation">{</span>
    j<span class="token punctuation">.</span>Events <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtBearerEvents</span>
    <span class="token punctuation">{</span>
      OnTokenValidated <span class="token operator">=</span> context <span class="token operator">=&gt;</span>
      <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> userService <span class="token operator">=</span> context<span class="token punctuation">.</span>HttpContext<span class="token punctuation">.</span>RequestServices<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetRequiredService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IUserService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> userId <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Principal<span class="token punctuation">.</span>Identity<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">GetBy</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          context<span class="token punctuation">.</span><span class="token function">Fail</span><span class="token punctuation">(</span><span class="token string">&quot;Unauthorized&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    j<span class="token punctuation">.</span>RequireHttpsMetadata <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    j<span class="token punctuation">.</span>SaveToken <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    j<span class="token punctuation">.</span>TokenValidationParameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TokenValidationParameters</span>
    <span class="token punctuation">{</span>
      ValidateIssuerSigningKey <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      IssuerSigningKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SymmetricSecurityKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span>
      ValidateIssuer <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      ValidateAudience <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IUserService<span class="token punctuation">,</span> UserService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IWebHostEnvironment</span> env<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
  app<span class="token punctuation">.</span><span class="token function">UseRouting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span><span class="token function">UseCors</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span><span class="token function">AllowAnyOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AllowAnyMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AllowAnyHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span><span class="token function">UseAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">UseAuthorization</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><ul><li><code>appsettings.json</code> 에 토큰 검증 시 사용할 <strong>Secret</strong> 을 넣습니다.</li></ul> <div class="language-json line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;AllowedHosts&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;SEQ_URL&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://seq:5341&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;AppSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;Secret&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SuperPowerPassword&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>Postman 을 통해 확인해보겠습니다.</li> <li>사용자 등록
<img src="/assets/img/postman.test.18.068b1fa8.png" alt="postman.test"></li> <li>사용자 인증
<img src="/assets/img/postman.test.19.78a5275c.png" alt="postman.test"></li> <li>JWT 토큰을 이용한 API 호출
<img src="/assets/img/postman.test.20.0e764d23.png" alt="postman.test"></li> <li>토큰 검증
<img src="/assets/img/postman.test.21.e2a1004c.png" alt="postman.test"></li></ul> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>여기에서 구현한 인증은 실제 production level 에서 사용하기에는 무리가 좀 있습니다. 실제 인증 서비스에서는 refresh token, HTTP Only cookie, XSS (cross site scripting), CSRF (cross site request forgery) 등 고려해야할 사항이 많습니다.<br>
이도 저도 다 귀찮을때 외부 인증서비스를 이용하는게 가장 편하긴 합니다. (<s>Firebase 인증 보니 잘 되어 있더군요</s>)<br>
추후 다른 포스트를 통해 외부 인증서비스 사용에 대해서도 다뤄볼까 합니다.</p></div> <h3 id="slightly-business-changes"><a href="#slightly-business-changes" class="header-anchor">#</a> Slightly business changes</h3> <p>Todo App 을 제작 의뢰한 클라이언트로 부터 추가적인 요구사항이 왔다고 가정하겠습니다. 할일 목록을 각각의 분류로 좀 나누고 싶다는 요구사항이 있다고 가정하겠습니다.</p> <p>Todo Item 들을 각각의 영역으로 구분짓기 위해 <a href="https://trello.com" target="_blank" rel="noopener noreferrer">Trello 사이트<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 처럼 각 보드별로 todo를 분리하기 위해 API 에 Board 별로 구분짓기 위한 요구사항을 적용해 보겠습니다.</p> <ul><li>요구사항: 각 Todo Item 을 각각의 Category 구분</li> <li>변경사항
<ol><li>Category 관련 모델 추가</li> <li>TodoItem 에 CategoryId 를 추가하여 분류 -&gt; TodoItem 모델에 <code>CategoryId</code> 컬럼 추가</li> <li>Category 를 관리할 수 있는 컨트롤러 추가</li> <li>TodoItemsController 의 GET, POST, PUT endpoint 에 CategoryId 추가 및 관련 로직 수정</li></ol></li></ul> <h4 id="_1-category-관련-모델-추가"><a href="#_1-category-관련-모델-추가" class="header-anchor">#</a> 1. Category 관련 모델 추가</h4> <ul><li><code>Models/Category.cs</code>, <code>Models/CategoryDTO.cs</code> 추가</li></ul> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Category</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">long</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Timestamp</span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> RowVersion <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CategoryDTO</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">long</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li><strong>DbContext</strong> 에 Category 추가</li></ul> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TodoContext</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DbContext</span></span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token function">TodoContext</span><span class="token punctuation">(</span><span class="token class-name">DbContextOptions<span class="token punctuation">&lt;</span>TodoContext<span class="token punctuation">&gt;</span></span> options<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnConfiguring</span><span class="token punctuation">(</span><span class="token class-name">DbContextOptionsBuilder</span> optionsBuilder<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>TodoItem<span class="token punctuation">&gt;</span></span> TodoItems <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>Category<span class="token punctuation">&gt;</span></span> Categories <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>ef core 마이그레이션 추가</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ dotnet ef migrations <span class="token function">add</span> AddCategory
$ dotnet ef migrations list
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_2-todoitem-및-todoitemdto-에-categoryid-추가"><a href="#_2-todoitem-및-todoitemdto-에-categoryid-추가" class="header-anchor">#</a> 2. TodoItem 및 TodoItemDTO 에 CategoryId 추가</h4> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TodoItem</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">long</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">long</span></span> CategoryId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DefaultValue</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsCompleted <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Timestamp</span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> RowVersion <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TodoItemDTO</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">long</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">long</span></span> CategoryId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DefaultValue</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsComplete <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ul><li>migration 생성 및 관련 스크립트 생성</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ dotnet ef migrations <span class="token function">add</span> AddCategoryIdToTodoItem
$ dotnet ef migrations list

<span class="token comment"># project 디렉토리에서 진행하면 따로 프로젝트 지정하지 않아도 됨.</span>
$ dotnet ef migrations script <span class="token parameter variable">--idempotent</span> <span class="token parameter variable">-o</span> migrations02.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>DB 에 적용하기 위해서는 커맨드를 통해 <code>dotnet ef database update</code> 를 실행하거나 위에서 생성된 sql 을 Azure Data Studio 나 SSMS 에서 직접 실행하여 DB 에 반영합니다.</p></div> <h4 id="_3-categorycontroller-추가"><a href="#_3-categorycontroller-추가" class="header-anchor">#</a> 3. CategoryController 추가</h4> <ul><li><code>Controllers/CategoryController.cs</code> 추가 ()</li></ul> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Produces</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;api/[controller]&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiController</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CategoryController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ControllerBase</span></span>
    <span class="token punctuation">{</span>
      <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">TodoContext</span> _context<span class="token punctuation">;</span>
      <span class="token keyword">public</span> <span class="token function">CategoryController</span><span class="token punctuation">(</span><span class="token class-name">TodoContext</span> context<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        _context <span class="token operator">=</span> context <span class="token operator">??</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">CategoryExists</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">long</span></span> id<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _context<span class="token punctuation">.</span>Categories<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span>Id <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name">CategoryDTO</span> <span class="token function">CategoryToDTO</span><span class="token punctuation">(</span><span class="token class-name">Category</span> category<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CategoryDTO</span>
    <span class="token punctuation">{</span>
      Id <span class="token operator">=</span> category<span class="token punctuation">.</span>Id<span class="token punctuation">,</span>
      Name <span class="token operator">=</span> category<span class="token punctuation">.</span>Name
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 모든 카테고리를 불러옵니다.</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
    <span class="token punctuation">[</span>HttpGet<span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ActionResult<span class="token punctuation">&lt;</span>IEnumerable<span class="token punctuation">&lt;</span>CategoryDTO<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetCategorys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">await</span> _context<span class="token punctuation">.</span>Categories<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> <span class="token function">CategoryToDTO</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToListAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;{id}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ActionResult<span class="token punctuation">&lt;</span>CategoryDTO<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetCategory</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">long</span></span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">var</span></span> category <span class="token operator">=</span> <span class="token keyword">await</span> _context<span class="token punctuation">.</span>Categories<span class="token punctuation">.</span><span class="token function">FindAsync</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>category <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">return</span> <span class="token function">CategoryToDTO</span><span class="token punctuation">(</span>category<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPut</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;{id}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>IActionResult<span class="token punctuation">&gt;</span></span> <span class="token function">UpdateCategory</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">long</span></span> id<span class="token punctuation">,</span> <span class="token class-name">CategoryDTO</span> categoryDTO<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>id <span class="token operator">!=</span> categoryDTO<span class="token punctuation">.</span>Id<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">BadRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token class-name"><span class="token keyword">var</span></span> category <span class="token operator">=</span> <span class="token keyword">await</span> _context<span class="token punctuation">.</span>Categories<span class="token punctuation">.</span><span class="token function">FindAsync</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>category <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      category<span class="token punctuation">.</span>Name <span class="token operator">=</span> categoryDTO<span class="token punctuation">.</span>Name<span class="token punctuation">;</span>

      <span class="token keyword">try</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">await</span> _context<span class="token punctuation">.</span><span class="token function">SaveChangesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DbUpdateConcurrencyException</span><span class="token punctuation">)</span> <span class="token keyword">when</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CategoryExists</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">return</span> <span class="token function">NoContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// Category 를 생성합니다.</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;remarks&gt;</span>
    <span class="token comment">/// Sample request:</span>
    <span class="token comment">///</span>
    <span class="token comment">///   POST api/Category</span>
    <span class="token comment">///   {</span>
    <span class="token comment">///     name: &quot;Category 1&quot;</span>
    <span class="token comment">///   }</span>
    <span class="token comment">///   </span>
    <span class="token comment">/// &lt;/remarks&gt;</span>
    <span class="token comment">/// &lt;param name=&quot;categoryDTO&quot;&gt;&lt;/param&gt;</span>
    <span class="token comment">/// &lt;returns&gt;생성된 Category&lt;/returns&gt;</span>
    <span class="token comment">/// &lt;response code=&quot;201&quot;&gt;생성된 Category&lt;/response&gt;</span>
    <span class="token comment">/// &lt;response code=&quot;400&quot;&gt;category 가 null 일 경우&lt;/response&gt;</span>
    <span class="token punctuation">[</span>HttpPost<span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ProducesResponseType</span><span class="token attribute-arguments"><span class="token punctuation">(</span>StatusCodes<span class="token punctuation">.</span>Status201Created<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ProducesResponseType</span><span class="token attribute-arguments"><span class="token punctuation">(</span>StatusCodes<span class="token punctuation">.</span>Status400BadRequest<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ActionResult<span class="token punctuation">&lt;</span>Category<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">CreateCategory</span><span class="token punctuation">(</span><span class="token class-name">CategoryDTO</span> categoryDTO<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">var</span></span> category <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Category</span>
      <span class="token punctuation">{</span>
        Name <span class="token operator">=</span> categoryDTO<span class="token punctuation">.</span>Name
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      _context<span class="token punctuation">.</span>Categories<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>category<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> _context<span class="token punctuation">.</span><span class="token function">SaveChangesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token function">CreatedAtAction</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>GetCategory<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> id <span class="token operator">=</span> category<span class="token punctuation">.</span>Id <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function">CategoryToDTO</span><span class="token punctuation">(</span>category<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpDelete</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;{id}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>IActionResult<span class="token punctuation">&gt;</span></span> <span class="token function">DeleteCategory</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">long</span></span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">var</span></span> category <span class="token operator">=</span> <span class="token keyword">await</span> _context<span class="token punctuation">.</span>Categories<span class="token punctuation">.</span><span class="token function">FindAsync</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>category <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      _context<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>category<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> _context<span class="token punctuation">.</span><span class="token function">SaveChangesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token function">NoContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br></div></div><h4 id="_4-todoitemscontroller-관련사항-변경"><a href="#_4-todoitemscontroller-관련사항-변경" class="header-anchor">#</a> 4. TodoItemsController 관련사항 변경</h4> <ul><li>TodoItemsController 에 관련 메서드들을 수정합니다.</li></ul> <div class="language-csharp line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name">TodoItemDTO</span> <span class="token function">ItemToDTO</span><span class="token punctuation">(</span><span class="token class-name">TodoItem</span> todoItem<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TodoItemDTO</span>
<span class="token punctuation">{</span>
  Id <span class="token operator">=</span> todoItem<span class="token punctuation">.</span>Id<span class="token punctuation">,</span>
  Name <span class="token operator">=</span> todoItem<span class="token punctuation">.</span>Name<span class="token punctuation">,</span>
  IsComplete <span class="token operator">=</span> todoItem<span class="token punctuation">.</span>IsCompleted<span class="token punctuation">,</span>
  CategoryId <span class="token operator">=</span> todoItem<span class="token punctuation">.</span>CategoryId
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPut</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;{id}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>IActionResult<span class="token punctuation">&gt;</span></span> <span class="token function">UpdateTodoItem</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">long</span></span> id<span class="token punctuation">,</span> <span class="token class-name">TodoItemDTO</span> todoItemDTO<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
  todoItem<span class="token punctuation">.</span>Name <span class="token operator">=</span> todoItemDTO<span class="token punctuation">.</span>Name<span class="token punctuation">;</span>
  todoItem<span class="token punctuation">.</span>IsCompleted <span class="token operator">=</span> todoItemDTO<span class="token punctuation">.</span>IsComplete<span class="token punctuation">;</span>
  todoItem<span class="token punctuation">.</span>CategoryId <span class="token operator">=</span> todoItemDTO<span class="token punctuation">.</span>CategoryId<span class="token punctuation">;</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ActionResult<span class="token punctuation">&lt;</span>TodoItem<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">CreateTodoItem</span><span class="token punctuation">(</span><span class="token class-name">TodoItemDTO</span> todoItemDTO<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token class-name"><span class="token keyword">var</span></span> todoItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TodoItem</span>
  <span class="token punctuation">{</span>
    IsCompleted <span class="token operator">=</span> todoItemDTO<span class="token punctuation">.</span>IsComplete<span class="token punctuation">,</span>
    Name <span class="token operator">=</span> todoItemDTO<span class="token punctuation">.</span>Name<span class="token punctuation">,</span>
    CategoryId <span class="token operator">=</span> todoItemDTO<span class="token punctuation">.</span>CategoryId
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><ul><li>Postman 등으로 테스트 해봅니다.
<img src="/assets/img/postman.test.15.7b7015b0.png" alt="postman.test"> <img src="/assets/img/postman.test.16.9b7f3d24.png" alt="postman.test"> <img src="/assets/img/postman.test.17.3c979642.png" alt="postman.test"></li></ul> <h3 id="conclusion"><a href="#conclusion" class="header-anchor">#</a> Conclusion</h3> <p>여기까지 기본적인 API 구현은 마무리 합니다. Infra 와 Backend 의 영역은 더 복잡해질 수 있는 개연성이 충분히 존재하는 부분입니다. Tutorial 이 너무 복잡해지는 것을 막고자 여기까지만 구현하지만 추후 더 내용을 보강해볼 생각입니다.<br>
이 섹션에서 다루는 기술이 전부가 아닐뿐더러 더 좋은 방법들이 훨씬 많습니다. 나머지 부분에서 좀 더 다뤄볼 수 있지 않을까 합니다. 일단 다음 파트에서는 Frontend 를 구현해 보도록 하겠습니다.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> <div id="disqus_thread" class="content" data-v-9cf26668></div></main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.235aa418.js" defer></script><script src="/assets/js/32.2f97a545.js" defer></script><script src="/assets/js/2.c6e841d7.js" defer></script><script src="/assets/js/1.be22eaca.js" defer></script><script src="/assets/js/10.08dc9b50.js" defer></script><script src="/assets/js/39.8f7876c0.js" defer></script><script src="/assets/js/40.0f869326.js" defer></script>
  </body>
</html>
